
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Common tabular operations in pandas</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/landing-page.css?v=ca7933c4" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom-toggle-button.css?v=14db4526" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom-text-formatting.css?v=4ef71e6f" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'part1/chapter-03/md/01-data-manipulation';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
    
    <img src="../../../_static/pythongis-logo.png" class="logo__image only-light" alt=" - Home"/>
    <img src="../../../_static/pythongis-logo.png" class="logo__image only-dark pst-js-only" alt=" - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Part I - Python essentials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Overview and learning goals</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../chapter-01/index.html">1. Getting started</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-01/nb/0-learning-objectives.html">Learning objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-01/nb/00-motivation.html">1.1 Motivation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-01/nb/01-computers-and-programs.html">1.2 Computers and programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-01/nb/02-why-python.html">1.3 Why Python?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-01/nb/03-writing-and-running-python-code.html">1.4 Writing and running Python code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-01/nb/04-using-jupyterlab.html">1.5 Using JupyterLab for writing code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-01/nb/05-quick-start.html">1.6 Quickly getting started (without installing Python)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-01/nb/06-installation.html">1.7 Installing Python and adding libraries</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../chapter-02/index.html">2. Basic programming concepts</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-02/nb/0-learning-objectives.html">Learning objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-02/nb/00-python-basics.html">2.1 Getting started with Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-02/nb/01-lists-and-indices.html">2.2 Lists and indices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-02/nb/02-text-and-numbers.html">2.3 Working with text and numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-02/nb/03-for-loops.html">2.4 for loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-02/nb/04-conditional-statements.html">2.5 Conditional statements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-02/nb/05-functions.html">2.6 Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-02/nb/06-writing-scripts.html">2.7 Writing script files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-02/nb/07-modules.html">2.8 Loading and using modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-02/nb/08-exercises.html">Exercises</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../index.html">3. Introduction to data analysis</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../nb/0-learning-objectives.html">Learning objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nb/00-pandas-basics.html">3.1 Getting started with data analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nb/01-data-manipulation.html">3.2 Common tabular operations in pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nb/02-data-analysis.html">3.3 Data wrangling, grouping and aggregation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nb/03-temporal-data.html">3.4 Working with temporal data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nb/04-exercises.html">Exercises</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../chapter-04/index.html">4. Introduction to data visualization</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-04/nb/0-learning-objectives.html">Learning objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-04/nb/00-plotting-in-python.html">4.1 Plotting in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-04/nb/01-basic-plotting.html">4.2 Plotting with pandas and matplotlib</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-04/nb/02-subplots.html">4.3 Creating subplots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-04/nb/03-plot-formatting.html">4.4 Effective plot design: line plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-04/nb/04-exercises.html">Exercises</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part II - Introduction to GIS with Python</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../part2/index.html">Overview and learning goals</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../part2/chapter-05/index.html">5. Getting started</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-05/nb/0-learning-objectives.html">Learning objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-05/nb/00-motivation-to-use-python-for-gis.html">5.1 Motivation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-05/nb/01-introduction-to-geographic-data-in-python.html">5.2 Geographic data in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-05/nb/02-introduction-to-coordinate-reference-systems.html">5.3 Coordinate reference systems</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../part2/chapter-06/index.html">6. Vector data processing</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-06/nb/0-learning-objectives.html">Learning objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-06/nb/00-introduction-to-geographic-objects.html">6.1 Representing geographic data in vector format</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-06/nb/01-geodataframe.html">6.2 Introduction to geopandas GeoDataFrames</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-06/nb/02-geometric-operations.html">6.3 Common geometric operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-06/nb/03-coordinate-reference-system.html">6.4 Working with map projections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-06/nb/04-geocoding.html">6.5 Geocoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-06/nb/05-spatial-queries.html">6.6 Selecting data based on spatial relationships</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-06/nb/06-spatial-join.html">6.7 Spatial join</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-06/nb/07-nearest-neighbour.html">6.8 Nearest neighbour analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-06/nb/08-overlay-analysis-with-vector-data.html">6.9 Vector overlay operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-06/nb/09-exercises.html">Exercises</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../part2/chapter-07/index.html">7. Raster data processing</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-07/nb/0-learning-objectives.html">Learning objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-07/nb/00-introduction-to-raster-data.html">7.1 Representing geographic data in raster format</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-07/nb/01-data-structures-xarray.html">7.2 Introduction to data structures in xarray</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-07/nb/02-common-raster-operations.html">7.3 Common raster operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-07/nb/03-coordinate-reference-systems-raster.html">7.4 Coordinate reference system management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-07/nb/04-map-algebra.html">7.5 Map algebra</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-07/nb/05-data-cubes.html">7.6 Working with data cubes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-07/nb/06-surface-analysis.html">7.7 Surface analysis</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../part2/chapter-08/index.html">8. Geographic data visualization</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-08/nb/0-learning-objectives.html">Learning objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-08/nb/00-introduction-to-geographic-visualization.html">8.1 Introduction to geographic visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-08/nb/01-static-vector-maps.html">8.2 Static maps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-08/nb/02-static-raster-maps.html">8.3 Visualizing raster layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-08/nb/03-interactive-maps.html">8.4 Interactive maps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-08/nb/04-map-design-principles-and-colors.html">8.5 Designing maps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-08/nb/05-exercises.html">Exercises</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../part2/chapter-09/index.html">9. Using online geographic data sources</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-09/nb/0-learning-objectives.html">Learning objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-09/nb/00-retrieving-osm-data.html">9.1 Retrieving OpenStreetMap data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-09/nb/01-retrieving-data-from-wfs.html">9.2 Retrieving data from Web Feature Service (WFS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-09/nb/02-retrieving-data-from-wcs.html">9.3 Retrieving data from Web Coverage Service (WCS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-09/nb/03-read-data-from-spatial-databases.html">9.4 Reading data from spatial databases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-09/nb/04-exercises.html">Exercises</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part III - Case studies</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../part3/chapter-10/index.html">10. Spatial interpolation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../part3/chapter-10/nb/00-introduction-to-spatial-interpolation.html">Introduction to spatial interpolation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part3/chapter-10/nb/01-inverse-distance-weighting.html">Inverse Distance Weighting interpolation with Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part3/chapter-10/nb/02-exercises.html">Exercises</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../part3/chapter-11/index.html">11. Spatial network analysis</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../part3/chapter-11/nb/00-introduction-to-spatial-network-analysis.html">Introduction to spatial network analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part3/chapter-11/nb/02-multimodal-spatial-accessibility-modelling.html">Multimodal spatial accessibility analysis with Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part3/chapter-11/nb/03-exercises.html">Exercises</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../part3/chapter-12/index.html">12. Terrain analysis</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../part3/chapter-12/nb/00-introduction-to-terrain-analysis.html">Introduction to terrain analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part3/chapter-12/nb/01-interpreting-topographic-features.html">Interpreting topographic features from raster data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part3/chapter-12/nb/02-exercises.html">Exercises</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../../part3/chapter-13/index.html">13. Conclusions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../back-matter/appendix-a.html">A. Working effectively in Python</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../back-matter/nb/appendix-0-python-environments.html">Installing and managing Python environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../back-matter/nb/appendix-1-best-practices.html">Python programming best practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../back-matter/nb/appendix-2-git-github.html">Version control with git/GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../back-matter/nb/appendix-3-script-files.html">Using Python script files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../back-matter/nb/appendix-4-testing-and-debugging.html">Testing and debugging your code</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../back-matter/appendix-b.html">B. Spatial index efficiency</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../back-matter/nb/appendix-5-spatial-index.html">Spatial index - How to boost spatial queries?</a></li>

</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../back-matter/appendix-c.html">C. Solutions to questions and exercises</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../back-matter/nb/appendix-6-question-solutions.html">Question solutions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../back-matter/nb/appendix-7-exercise-solutions.html">Exercise solutions</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Back matter</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../back-matter/nb/acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../back-matter/nb/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../back-matter/nb/references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">About the authors</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Datasets</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../data/index.html">Data overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data/noaa-data.html">NOAA Weather data</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/Python-GIS-book/site/edit/main/part1/chapter-03/md/01-data-manipulation.md" target="_blank"
   class="btn btn-sm btn-source-edit-button"
   title="Suggest edit"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/part1/chapter-03/md/01-data-manipulation.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Common tabular operations in pandas</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-calculations">Basic calculations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#question-3-4">Question 3.4</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#selecting-and-updating-data">Selecting and updating data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#selecting-rows-and-columns">Selecting rows and columns</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#question-3-5">Question 3.5</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#selecting-a-single-row-or-value">Selecting a single row or value</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#selections-based-on-index-positions">Selections based on index positions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#selections-using-listed-criteria">Selections using listed criteria</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conditional-selections">Conditional selections</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#question-3-6">Question 3.6</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#view-versus-a-copy">View versus a copy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dealing-with-missing-data">Dealing with missing data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-type-conversions">Data type conversions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sorting-data">Sorting data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-join-combining-dataframes-using-a-common-key">Table join: Combining DataFrames using a common key</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-logic-of-a-table-join">Basic logic of a table join</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#table-join-using-pandas-merge">Table join using pandas <code class="docutils literal notranslate"><span class="pre">.merge()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#footnotes">Footnotes</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <!-- #region deletable=true editable=true slideshow={"slide_type": ""} -->
<section class="tex2jax_ignore mathjax_ignore" id="common-tabular-operations-in-pandas">
<h1>Common tabular operations in pandas<a class="headerlink" href="#common-tabular-operations-in-pandas" title="Link to this heading">#</a></h1>
<p>We have new learned the basics of <code class="docutils literal notranslate"><span class="pre">pandas</span></code> data structures (i.e., <code class="docutils literal notranslate"><span class="pre">Series</span></code> and <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>) and you should be familiar with some methods for loading and exploring <code class="docutils literal notranslate"><span class="pre">pandas</span></code> data. Next, we will continue exploring the <code class="docutils literal notranslate"><span class="pre">pandas</span></code> data analysis functionalities, and see how it can be used for data manipulation, conducting simple calculations, and making selections based on specific criteria.</p>
<!-- #endregion -->
<!-- #region editable=true slideshow={"slide_type": ""} -->
<section id="basic-calculations">
<h2>Basic calculations<a class="headerlink" href="#basic-calculations" title="Link to this heading">#</a></h2>
<p>One of the most common things to do in <code class="docutils literal notranslate"><span class="pre">pandas</span></code> is to create new columns based on calculations between different variables (columns). Next, we will learn how to do this using the same input data (<code class="docutils literal notranslate"><span class="pre">data/kumpula-summer-2024.txt</span></code>) as in the previous section. We will first load it using the <code class="docutils literal notranslate"><span class="pre">pd.read_csv()</span></code> method. Remember, that the first 8 lines contains the metadata which we will skip. This time, let’s store the filepath as a separate variable in order to make the code more readable and easier to change afterwards (a good practice).</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Define file path:</span>
<span class="n">fp</span> <span class="o">=</span> <span class="s2">&quot;data/kumpula-summer-2024.txt&quot;</span>

<span class="c1"># Read in the data from the file (starting at row 9):</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
<p>As a first step, it is always good to remember to check the data after reading it. This way we can be sure that everything looks as it should.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<p>Everything seems to be OK. Now we can start by creating a new column <code class="docutils literal notranslate"><span class="pre">DIFF</span></code> in our <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. This can be done by specifying the name of the column and giving it some default value (in this case the decimal number <code class="docutils literal notranslate"><span class="pre">0.0</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;DIFF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<!-- #region deletable=true editable=true -->
<p>As we can see, now we have a new column <code class="docutils literal notranslate"><span class="pre">DIFF</span></code> in our <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> that has value <code class="docutils literal notranslate"><span class="pre">0.0</span></code> for all rows. When creating a new column, you can initialize it with any value you want. Typically, the value could be a number (<code class="docutils literal notranslate"><span class="pre">0.0</span></code> as we use here), but it could also be <code class="docutils literal notranslate"><span class="pre">None</span></code> (i.e., nothing), some text (e.g., <code class="docutils literal notranslate"><span class="pre">&quot;test</span> <span class="pre">text&quot;</span></code>), or more or less any other value or object that can be represented as a single item. You could even initialize the column by storing a function inside the cells if you like. Let’s continue by checking the data type of our new column.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;DIFF&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
<!-- #region deletable=true editable=true -->
<p>As we can see, <code class="docutils literal notranslate"><span class="pre">pandas</span></code> created a new column and automatically recognized that the data type is <code class="docutils literal notranslate"><span class="pre">float64</span></code> as we passed a <code class="docutils literal notranslate"><span class="pre">0.0</span></code> value to it. Great, but what about making those calculations with <code class="docutils literal notranslate"><span class="pre">pandas</span></code> as promised at the start of this section? Next, we will calculate the difference between the <code class="docutils literal notranslate"><span class="pre">MAX</span></code> and <code class="docutils literal notranslate"><span class="pre">MIN</span></code> columns to get an idea how much the temperatures have been varied on different days. The result will be updated into the column <code class="docutils literal notranslate"><span class="pre">DIFF</span></code> that we created earlier. A typical way of performing calculations such as this is to access the set of <code class="docutils literal notranslate"><span class="pre">Series</span></code> (columns) from the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> that interests us and perform the mathematical calculation using the selected columns. Typically you store the result directly into a column in the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, such as shown below.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;DIFF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;MAX&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;MIN&quot;</span><span class="p">]</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<!-- #region deletable=true editable=true -->
<p>As expected, the output from the calculations was stored into the <code class="docutils literal notranslate"><span class="pre">DIFF</span></code> column. Conducting calculations like this is extremely fast in <code class="docutils literal notranslate"><span class="pre">pandas</span></code> because the math operations happen in a vectorized manner. This means that instead of looping over individual values of the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> and comparing them to each other individually, calculating the difference happens simultaneously at all rows. You can also create new columns on the fly when doing the calculation (i.e., the column does not have to exist beforehand). Furthermore, it is possible to use any kind of math algebra (e.g., subtraction, addition, multiplication, division, exponentiation, etc.) when creating new columns. We can, for example, calculate another estimate of the average daily temperature by averaging the values in the <code class="docutils literal notranslate"><span class="pre">TEMP1</span></code> and <code class="docutils literal notranslate"><span class="pre">TEMP2</span></code> columns and storing the result as <code class="docutils literal notranslate"><span class="pre">TEMP</span></code>.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;TEMP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;TEMP1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;TEMP2&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} tags=["question"] -->
<section id="question-3-4">
<h3>Question 3.4<a class="headerlink" href="#question-3-4" title="Link to this heading">#</a></h3>
<p>Calculate the temperatures in Kelvins using the Celsius values and store the result in a new column called <code class="docutils literal notranslate"><span class="pre">TEMP_KELVIN</span></code> in our <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. Zero Kelvins is is -273.15 degrees Celsius as we learned in Chapter 2, and the formula for converting degrees Celsius (C) to Kelvins (K) is thus <span class="math notranslate nohighlight">\(T_{K} = T_{C} + 273.15\)</span>.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use this cell to enter your solution.</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">data</span><span class="p">[</span><span class="s2">&quot;TEMP_KELVIN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;TEMP&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">273.15</span>
</pre></div>
</div>
<!-- #region deletable=true editable=true slideshow={"slide_type": ""} -->
</section>
</section>
<section id="selecting-and-updating-data">
<h2>Selecting and updating data<a class="headerlink" href="#selecting-and-updating-data" title="Link to this heading">#</a></h2>
<p>We often want to make selections from our data and only use specific rows from a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> in the analysis. There are multiple ways of selecting subsets from a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> that can be based on specific index values, for example, or using some predefined criteria to make the selection such as selecting all rows where values in column <code class="docutils literal notranslate"><span class="pre">X</span></code> are larger than <code class="docutils literal notranslate"><span class="pre">0.0</span></code>. Next, we will go through the most useful ways of selecting specific rows, columns, and individual values.</p>
<!-- #endregion -->
<!-- #region editable=true slideshow={"slide_type": ""} -->
<section id="selecting-rows-and-columns">
<h3>Selecting rows and columns<a class="headerlink" href="#selecting-rows-and-columns" title="Link to this heading">#</a></h3>
<p>One common way of selecting only specific rows from a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> is done via the concept of slicing. Getting a slice of data in <code class="docutils literal notranslate"><span class="pre">pandas</span></code> can be done in a similar manner as with normal Python lists, by specifying an index range inside square brackets: <code class="docutils literal notranslate"><span class="pre">DataFrame[start_index:stop_index]</span></code>. Let’s select the first five rows and assign them to a variable called <code class="docutils literal notranslate"><span class="pre">selection</span></code>. Here, we will first see how selecting the data based on index values works just like with “normal” Python lists.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">selection</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
<span class="n">selection</span>
</pre></div>
</div>
<!-- #region deletable=true editable=true slideshow={"slide_type": ""} -->
<p>Here we have selected the first five rows (index <code class="docutils literal notranslate"><span class="pre">0</span></code>-<code class="docutils literal notranslate"><span class="pre">4</span></code>) using the integer index. Notice that the logic here is similar to how Python’s <code class="docutils literal notranslate"><span class="pre">list</span></code> slicing (or <code class="docutils literal notranslate"><span class="pre">range()</span></code> function) works; the value on the right side of the colon (here number <code class="docutils literal notranslate"><span class="pre">5</span></code>) is the stop value, which is excluded from the range selection. Hence, the syntax is <code class="docutils literal notranslate"><span class="pre">[start_index:stop_index]</span></code>. In addition, the parameter <code class="docutils literal notranslate"><span class="pre">:step</span></code> could be added at the end in indicate the step size between values (<code class="docutils literal notranslate"><span class="pre">1</span></code> by default).</p>
<!-- #endregion -->
<!-- #region deletable=true editable=true slideshow={"slide_type": ""} -->
<p>Selections like the previous example are possible, but there is a better and more flexible way of selecting data using the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.loc.html"><code class="docutils literal notranslate"><span class="pre">pandas</span></code> <code class="docutils literal notranslate"><span class="pre">.loc[]</span></code> label-based indexer</a> <a class="footnote-reference brackets" href="#loc" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>. As the name suggests, <code class="docutils literal notranslate"><span class="pre">.loc[]</span></code> selects data based on axis labels (row and column labels). This alone does not necessarily tell much to you at this point, but <code class="docutils literal notranslate"><span class="pre">.loc[]</span></code> makes it possible to conduct more specific selections, such as allowing you to choose which columns are chosen when selecting a subset of rows. It also makes possible to benefit from row labels that are not necessarily sequential numbers (as has been the case with all our examples thus far). For instance, you can make selections for rows indexed by dates or timestamps. Hence, <code class="docutils literal notranslate"><span class="pre">.loc[]</span></code> can become very handy when working with time series data (we will learn more about this later). Let’s now test out the <code class="docutils literal notranslate"><span class="pre">.loc[]</span></code> label indexer by selecting values from column <code class="docutils literal notranslate"><span class="pre">TEMP</span></code> from rows <code class="docutils literal notranslate"><span class="pre">0</span></code>-<code class="docutils literal notranslate"><span class="pre">5</span></code>.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select temp column values on rows 0-5</span>
<span class="n">selection</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;TEMP&quot;</span><span class="p">]</span>
<span class="n">selection</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
<p>Notice that in this case, we get six rows of data (index <code class="docutils literal notranslate"><span class="pre">0</span></code>-<code class="docutils literal notranslate"><span class="pre">5</span></code>)! This happens because we are now doing the selection based on axis labels instead of normal Python collection indices. It is important to notice the difference between these two approaches, as mixing the two may cause confusion, incorrect analysis results, or bugs in your code. We recommend to use <code class="docutils literal notranslate"><span class="pre">.loc[]</span></code> whenever possible (there are specific cases when you may want to use other approaches). The basic syntax for using <code class="docutils literal notranslate"><span class="pre">.loc[]</span></code> is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">first_included_label</span><span class="p">:</span><span class="n">last_included_label</span><span class="p">,</span> <span class="n">columns</span><span class="p">]</span>
</pre></div>
</div>
<p>By looking at the syntax, you might imagine that it is possible to select multiple columns when using <code class="docutils literal notranslate"><span class="pre">.loc[]</span></code>. We can test this by selecting the <code class="docutils literal notranslate"><span class="pre">TEMP</span></code> and <code class="docutils literal notranslate"><span class="pre">TEMP_KELVIN</span></code> columns from a set of rows by passing the selected column names inside a list.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">selection</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;TEMP&quot;</span><span class="p">,</span> <span class="s2">&quot;TEMP_KELVIN&quot;</span><span class="p">]]</span>
<span class="n">selection</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
<p>As a result, we now have a new <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> with two columns and 6 rows (i.e., index labels ranging from <code class="docutils literal notranslate"><span class="pre">0</span></code> to <code class="docutils literal notranslate"><span class="pre">5</span></code>).</p>
<!-- #endregion -->
<!-- #region editable=true slideshow={"slide_type": ""} tags=["question"] -->
<section id="question-3-5">
<h4>Question 3.5<a class="headerlink" href="#question-3-5" title="Link to this heading">#</a></h4>
<p>Calculate the mean temperature for the last seven days of August 2024. Do the selection using the row index values.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use this cell to enter your solution.</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">85</span><span class="p">:</span><span class="mi">91</span><span class="p">,</span> <span class="s2">&quot;TEMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
</section>
</section>
<section id="selecting-a-single-row-or-value">
<h3>Selecting a single row or value<a class="headerlink" href="#selecting-a-single-row-or-value" title="Link to this heading">#</a></h3>
<p>You can also select an individual row from specific position using the <code class="docutils literal notranslate"><span class="pre">.loc[]</span></code> indexing. Here we select all the data values using index <code class="docutils literal notranslate"><span class="pre">4</span></code> (the 5th row).</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">row</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<span class="n">row</span>
</pre></div>
</div>
<!-- #region deletable=true editable=true slideshow={"slide_type": ""} -->
<p><code class="docutils literal notranslate"><span class="pre">.loc[]</span></code> indexing returns the values from that row as a <code class="docutils literal notranslate"><span class="pre">Series</span></code> where the indices are actually the column names of the row variables. Hence, you can access the value of an individual column by referring to its index using following format:</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print one attribute from the selected row</span>
<span class="n">row</span><span class="p">[</span><span class="s2">&quot;TEMP&quot;</span><span class="p">]</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
<p>Sometimes it is enough to access a single value in a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> directly. In this case, we can use the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.at.html"><code class="docutils literal notranslate"><span class="pre">pandas</span></code> <code class="docutils literal notranslate"><span class="pre">.at[]</span></code> indexer</a> <a class="footnote-reference brackets" href="#at" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a> instead of <code class="docutils literal notranslate"><span class="pre">.loc[]</span></code>.
Let’s select the temperature (column <code class="docutils literal notranslate"><span class="pre">TEMP</span></code>) on the first row (index <code class="docutils literal notranslate"><span class="pre">0</span></code>) of our <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">selection</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;TEMP&quot;</span><span class="p">]</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
<p>As an output, we get an individual value <code class="docutils literal notranslate"><span class="pre">23.7</span></code>. <code class="docutils literal notranslate"><span class="pre">.at[]</span></code> works only when accessing a single value, whereas the <code class="docutils literal notranslate"><span class="pre">.loc[]</span></code> can be used to access both single or multiple values at the same time. The end result when fetching a single value with <code class="docutils literal notranslate"><span class="pre">.loc[]</span></code> is exactly the same and the difference between the two approaches is minimal. Hence, we recommend using <code class="docutils literal notranslate"><span class="pre">.loc[]</span></code> in all cases because it is more flexible (<code class="docutils literal notranslate"><span class="pre">.at[]</span></code> is slightly faster but in most cases this does not make a difference).</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">selection</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;TEMP&quot;</span><span class="p">]</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
</section>
<section id="selections-based-on-index-positions">
<h3>Selections based on index positions<a class="headerlink" href="#selections-based-on-index-positions" title="Link to this heading">#</a></h3>
<p>As we have learned thus far, <code class="docutils literal notranslate"><span class="pre">.loc[]</span></code> and <code class="docutils literal notranslate"><span class="pre">.at[]</span></code> are based on the axis labels, the names of columns and rows. For positional based indexing, <code class="docutils literal notranslate"><span class="pre">pandas</span></code> has an <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iloc.html"><code class="docutils literal notranslate"><span class="pre">.iloc[]</span></code> indexer</a> <a class="footnote-reference brackets" href="#iloc" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>, which is based on integer value indices. With <code class="docutils literal notranslate"><span class="pre">.iloc[]</span></code> it is also possible to refer to the columns based on their index value (i.e., to a positional number of a column in the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>). For example, <code class="docutils literal notranslate"><span class="pre">data.iloc[0,</span> <span class="pre">0]</span></code> would return <code class="docutils literal notranslate"><span class="pre">20240601</span></code> in our example <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, which is the value on the first row and first column in the data.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check the first rows</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The value at position (0, 0) is </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
<p>The syntax for using <code class="docutils literal notranslate"><span class="pre">.iloc[]</span></code> is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">start_row_position</span><span class="p">:</span><span class="n">stop_row_position</span><span class="p">,</span>
      <span class="n">start_column_position</span><span class="p">:</span><span class="n">stop_column_position</span><span class="p">]</span>
</pre></div>
</div>
<p>Using this syntax, we can access the value on the first row and second column (<code class="docutils literal notranslate"><span class="pre">TEMP</span></code>) as follows:</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
<p>It is also possible to get ranges of rows and columns with <code class="docutils literal notranslate"><span class="pre">.iloc[]</span></code>. For example, we could select the <code class="docutils literal notranslate"><span class="pre">YEARMODA</span></code> and <code class="docutils literal notranslate"><span class="pre">TEMP</span></code> columns from the first five rows based on their indices (positions) in the data set. Here, we will select rows from positions 0 to 5 and columns from positions 0 to 2.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">selection</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">selection</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
<p>As a result we indeed get only two columns and the first five rows. It is important to notice is that the behavior in terms of how many rows are returned differs between <code class="docutils literal notranslate"><span class="pre">.iloc[]</span></code> and <code class="docutils literal notranslate"><span class="pre">.loc[]</span></code>. Here, the <code class="docutils literal notranslate"><span class="pre">.iloc[0:5]</span></code> returns 5 rows (following the Python list slicing behavior), whereas using <code class="docutils literal notranslate"><span class="pre">.loc[0:5]</span></code> would return 6 rows (i.e., also including the row at index <code class="docutils literal notranslate"><span class="pre">5</span></code>).</p>
<p>One handy functionality with <code class="docutils literal notranslate"><span class="pre">.iloc[]</span></code> is the ability to fetch data starting from the end of the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, similar to how values can be selected from the end of a Python <code class="docutils literal notranslate"><span class="pre">list</span></code>. It is possible to retrieve the last row in the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> by passing a negative number to <code class="docutils literal notranslate"><span class="pre">.iloc[]</span></code>, where value <code class="docutils literal notranslate"><span class="pre">-1</span></code> corresponds to the last row (or column), -2 corresponds to the second to last, and so on. Following this, it is easy to find the value in the last row and column (the final value in the <code class="docutils literal notranslate"><span class="pre">TEMP_KELVIN</span></code> column in our case).</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
</section>
<section id="selections-using-listed-criteria">
<h3>Selections using listed criteria<a class="headerlink" href="#selections-using-listed-criteria" title="Link to this heading">#</a></h3>
<p>Another common way of selecting rows from a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> is to provide a list of values that are used for finding matching rows in a specific <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> column. For example, selecting rows that match specific dates can be done by passing a list of values used as criteria to the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.isin.html"><code class="docutils literal notranslate"><span class="pre">.isin()</span></code> function of <code class="docutils literal notranslate"><span class="pre">pandas</span></code></a> <a class="footnote-reference brackets" href="#isin" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>. This will go through each value in the selected column (in this case <code class="docutils literal notranslate"><span class="pre">YEARMODA</span></code>) and check whether there is a match or not. As an output, the <code class="docutils literal notranslate"><span class="pre">.isin()</span></code> function returns a <code class="docutils literal notranslate"><span class="pre">Series</span></code> of Boolean values (True or False) that can be combined with <code class="docutils literal notranslate"><span class="pre">.loc[]</span></code> to do the final selection that returns only rows that meet the selection criteria.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># List of values that will be used as basis for selecting the rows</span>
<span class="n">selection_criteria</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20240601</span><span class="p">,</span> <span class="mi">20240708</span><span class="p">,</span> <span class="mi">20240809</span><span class="p">]</span>

<span class="c1"># Do the selection based on criteria applied to YEARMODA column</span>
<span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;YEARMODA&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">selection_criteria</span><span class="p">)]</span>
</pre></div>
</div>
<!-- #region deletable=true editable=true slideshow={"slide_type": ""} -->
</section>
<section id="conditional-selections">
<h3>Conditional selections<a class="headerlink" href="#conditional-selections" title="Link to this heading">#</a></h3>
<p>One really useful feature in <code class="docutils literal notranslate"><span class="pre">pandas</span></code> is the ability to easily filter and select rows based on a conditional statement. The following example shows how we can check whether the temperature at each row of the <code class="docutils literal notranslate"><span class="pre">MAX</span></code> column is greater than or equal to 25 degrees.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This cell sets the number of lines of pandas output to a maximum of 9</span>
<span class="c1"># The cell is removed when building the website/book PDF</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_rows&quot;</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;MAX&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">25</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
<p>As a result, we get a <code class="docutils literal notranslate"><span class="pre">Series</span></code> of Boolean values, where the value <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code> at each row determines whether or not our condition was met. This kind of <code class="docutils literal notranslate"><span class="pre">Series</span></code> or <code class="docutils literal notranslate"><span class="pre">numpy.array</span></code> of Boolean values based on some predefined criteria is typically called a mask. We can take advantage of this mask when doing selections with <code class="docutils literal notranslate"><span class="pre">.loc[]</span></code> based on specific criteria. In the following example, we use the same criterion as above and store all rows meeting the criterion into the variable <code class="docutils literal notranslate"><span class="pre">hot_temps</span></code> (“hot” temperatures). We can specify the criterion directly inside the square brackets of the <code class="docutils literal notranslate"><span class="pre">.loc[]</span></code> indexer. Let’s select rows that have a temperature greater than or equal to 25 degrees.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">hot_temps</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;MAX&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">25</span><span class="p">]</span>
<span class="n">hot_temps</span>
</pre></div>
</div>
<!-- #region deletable=true editable=true slideshow={"slide_type": ""} -->
<p>It is also possible to combine multiple criteria at the same time. Combining multiple criteria can be done using the <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> (and) or the <code class="docutils literal notranslate"><span class="pre">|</span></code> (or) operators. Notice, that it is often useful to separate the different conditional clauses with parentheses <code class="docutils literal notranslate"><span class="pre">()</span></code>. Let’s select rows having average daily temperatures above 20 degrees from the second half of the summer of 2024 (July 15th onwards).</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">warm_temps</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;TEMP&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;YEARMODA&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">20240715</span><span class="p">)]</span>
<span class="n">warm_temps</span>
</pre></div>
</div>
<!-- #region deletable=true editable=true slideshow={"slide_type": ""} -->
<p>Now we have a subset of our <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> with only rows where the <code class="docutils literal notranslate"><span class="pre">TEMP</span></code> is above 20 and the dates in <code class="docutils literal notranslate"><span class="pre">YEARMODA</span></code> column start from the 15th of July. Notice, that the index values (numbers on the left) are still showing the index labels from the original <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. This indicates that our result is a slice from the original data.</p>
<!-- #endregion -->
<!-- #region editable=true slideshow={"slide_type": ""} -->
<p>Of course, it is possible to reset the index using the <code class="docutils literal notranslate"><span class="pre">.reset_index()</span></code> function, which makes the index numbering to start from 0 and increases the index values in a sequential manner. This is often a useful operation to do because it makes it easier then to slice the data with <code class="docutils literal notranslate"><span class="pre">.loc[]</span></code> or <code class="docutils literal notranslate"><span class="pre">.iloc[]</span></code>. By default <code class="docutils literal notranslate"><span class="pre">.reset_index()</span></code> would make a new column called <code class="docutils literal notranslate"><span class="pre">index</span></code> to store the previous index, which might be useful in some cases. That is not the case here, so we can omit storing the old index by including the parameter <code class="docutils literal notranslate"><span class="pre">drop=True</span></code>.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">warm_temps</span> <span class="o">=</span> <span class="n">warm_temps</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">warm_temps</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
<p>As can be seen, now the index values goes from 0 to 26. Resetting the index has now also unlinked the <code class="docutils literal notranslate"><span class="pre">warm_temps</span></code> <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> from <code class="docutils literal notranslate"><span class="pre">data</span></code>, meaning that it is not a view anymore but an independent <code class="docutils literal notranslate"><span class="pre">pandas</span></code> object. When making selections, it is quite typical that <code class="docutils literal notranslate"><span class="pre">pandas</span></code> might give you warnings if you modify the selected data without first resetting the index or making a copy of the selected data. To demonstrate this, we will make the selection again and create a new column indicating days in which the temperature was “hot” (maximum temperature greater than 25 degrees Celsius).</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">warm_temps</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;TEMP&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;YEARMODA&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">20240715</span><span class="p">)]</span>
<span class="n">warm_temps</span><span class="p">[</span><span class="s2">&quot;HOT_TEMP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">warm_temps</span><span class="p">[</span><span class="s2">&quot;MAX&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">25</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
<p>In this case we have created a new column using the selection, which is a slice from the original data. As a result, <code class="docutils literal notranslate"><span class="pre">pandas</span></code> raises a warning about a possible invalid value assignment. In most cases this warning can be ignored, but it is a good practice to always make a copy when doing selections, especially if you continue working with the selected data and intend modify it further.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make the selection and make a copy</span>
<span class="n">warm_temps</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;TEMP&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;YEARMODA&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">20240715</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Now update the first value of the last column</span>
<span class="n">warm_temps</span><span class="p">[</span><span class="s2">&quot;HOT_TEMP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">warm_temps</span><span class="p">[</span><span class="s2">&quot;MAX&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">25</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
<p>As we can see, now we did not receive any warnings this time and it would be safe to continue working with this selection without needing to worry that there are some “hidden linkages” between the selection and another <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> that could cause issues (we discuss this more in the next section).</p>
<!-- #endregion -->
<!-- #region editable=true slideshow={"slide_type": ""} tags=["question"] -->
<section id="question-3-6">
<h4>Question 3.6<a class="headerlink" href="#question-3-6" title="Link to this heading">#</a></h4>
<p>Calculate the mean temperature for the last seven days of August 2024 again. This time you should select the rows based on a condition for the <code class="docutils literal notranslate"><span class="pre">YEARMODA</span></code> column.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use this cell to enter your solution.</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;TEMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;YEARMODA&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">20240825</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
</section>
</section>
<section id="view-versus-a-copy">
<h3>View versus a copy<a class="headerlink" href="#view-versus-a-copy" title="Link to this heading">#</a></h3>
<p>As we have seen above, making a selection can sometimes result to something called a view. In such cases, the selection and the original data may still linked to each other. This happens, for example, if you make a selection like above but return only a single column from the original source data. In a situation where you have a view, a change in the original data for that specific column can also change the value in the selection. This behavior can be confusing and yield unexpected consequences, so a good practice to follow is to always make a copy whenever doing selections to unlink the source <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> from the selection. You can make a copy easily while doing the selection by adding <code class="docutils literal notranslate"><span class="pre">.copy()</span></code> at the end of the selection command.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">selection</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;TEMP&quot;</span><span class="p">,</span> <span class="s2">&quot;TEMP_KELVIN&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">selection</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
<p>Now we have the exact same data in our end result, but we have ensured that the selection is not linked to the original data anymore. To demonstrate what can happen with the view, let’s make a selection of a single column from the selection data (which will be a view), and modify the data a bit to demonstrate the consequences if we are not careful.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">temp</span> <span class="o">=</span> <span class="n">selection</span><span class="p">[</span><span class="s2">&quot;TEMP&quot;</span><span class="p">]</span>
<span class="n">temp</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
<p>Now if we make a change to our original data <code class="docutils literal notranslate"><span class="pre">selection</span></code> it will also influence our values in <code class="docutils literal notranslate"><span class="pre">temp</span></code>.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">selection</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">30.0</span>
<span class="n">selection</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check the values in temp (which we did not modify)</span>
<span class="n">temp</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
<p>As we can see, the value in our <code class="docutils literal notranslate"><span class="pre">temp</span></code> <code class="docutils literal notranslate"><span class="pre">Series</span></code> has changed from <code class="docutils literal notranslate"><span class="pre">23.70</span></code> to <code class="docutils literal notranslate"><span class="pre">30.00</span></code> although we did not make any change to it directly. The change happened because the data objects were still linked to each other.</p>
<!-- #endregion -->
<!-- #region deletable=true editable=true slideshow={"slide_type": ""} -->
</section>
</section>
<section id="dealing-with-missing-data">
<h2>Dealing with missing data<a class="headerlink" href="#dealing-with-missing-data" title="Link to this heading">#</a></h2>
<p>As you may have noticed by now, we have several missing values for the temperature minimum, maximum, and average columns (<code class="docutils literal notranslate"><span class="pre">MIN</span></code>, <code class="docutils literal notranslate"><span class="pre">MAX</span></code>, and <code class="docutils literal notranslate"><span class="pre">TEMP</span></code>). These missing values appear as <code class="docutils literal notranslate"><span class="pre">NaN</span></code> (not a number). Having missing data in your data file is quite common and typically you want to deal with these values somehow. Common procedures to deal with <code class="docutils literal notranslate"><span class="pre">NaN</span></code> values are to either remove them from the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> or replace (fill) them with some other value. In <code class="docutils literal notranslate"><span class="pre">pandas</span></code>, both of these options are easy to do. Let’s first start by checking whether the data we are using has and <code class="docutils literal notranslate"><span class="pre">NaN</span></code> values.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">warm_temps</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
<p>As we can see, the <code class="docutils literal notranslate"><span class="pre">MIN</span></code> and <code class="docutils literal notranslate"><span class="pre">TEMP</span></code> columns are clearly missing values at index <code class="docutils literal notranslate"><span class="pre">82</span></code>. It is also possible to confirm this with <code class="docutils literal notranslate"><span class="pre">pandas</span></code> by accessing a specific <code class="docutils literal notranslate"><span class="pre">Series</span></code> attribute called <code class="docutils literal notranslate"><span class="pre">.hasnans</span></code>, which can be a handy tool when automating a data analysis pipeline. Each <code class="docutils literal notranslate"><span class="pre">Series</span></code> (or column) in the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> has this attribute. Let’s check whether the <code class="docutils literal notranslate"><span class="pre">MIN</span></code> column contains any <code class="docutils literal notranslate"><span class="pre">NaN</span></code> values.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">warm_temps</span><span class="p">[</span><span class="s2">&quot;MIN&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">hasnans</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
<p>The <code class="docutils literal notranslate"><span class="pre">.hasnans</span></code> attribute will be either <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code> depending on whether or not the <code class="docutils literal notranslate"><span class="pre">Series</span></code> contains any <code class="docutils literal notranslate"><span class="pre">NaN</span></code> values. Let’s now see how we can remove the missing data values (i.e., clean the data) using the <code class="docutils literal notranslate"><span class="pre">.dropna()</span></code> function. Inside the <code class="docutils literal notranslate"><span class="pre">.dropna()</span></code> function you can pass a list of column(s) in which the <code class="docutils literal notranslate"><span class="pre">NaN</span></code> values should be processed by using the <code class="docutils literal notranslate"><span class="pre">subset</span></code> parameter.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cols_to_check</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MIN&quot;</span><span class="p">]</span>
<span class="n">warm_temps_clean</span> <span class="o">=</span> <span class="n">warm_temps</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">cols_to_check</span><span class="p">)</span>
<span class="n">warm_temps_clean</span>
</pre></div>
</div>
<!-- #region deletable=true editable=true slideshow={"slide_type": ""} -->
<p>As you can see by looking at the output above, we now have a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> without <code class="docutils literal notranslate"><span class="pre">NaN</span></code> values in the <code class="docutils literal notranslate"><span class="pre">MIN</span></code> column (we have only 23 rows compared to 27 before cleaning). However, you might recall that there may also have been <code class="docutils literal notranslate"><span class="pre">NaN</span></code> values in the <code class="docutils literal notranslate"><span class="pre">MAX</span></code> column. In order to drop all rows containing <code class="docutils literal notranslate"><span class="pre">NaN</span></code> values, we could instead to the following:</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">warm_temps_clean</span> <span class="o">=</span> <span class="n">warm_temps</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">warm_temps_clean</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
<p>In this case we can see an additional 2 rows have been dropped due to the <code class="docutils literal notranslate"><span class="pre">NaN</span></code> values that were in the <code class="docutils literal notranslate"><span class="pre">MAX</span></code> column. However, it is using <code class="docutils literal notranslate"><span class="pre">.dropna()</span></code> without the <code class="docutils literal notranslate"><span class="pre">subset</span></code> parameter is not recommended as sometimes it can result in dropping data you may not want to remove. Thus, we generally recommend always using the <code class="docutils literal notranslate"><span class="pre">subset</span></code> parameter with the list of columns from which to remove <code class="docutils literal notranslate"><span class="pre">NaN</span></code> values.</p>
<p>Of course, by dropping rows using <code class="docutils literal notranslate"><span class="pre">.dropna()</span></code> you naturally lose data (rows), which might not be an optimal solution for all cases. Because of this, <code class="docutils literal notranslate"><span class="pre">pandas</span></code> also provides an option to fill the <code class="docutils literal notranslate"><span class="pre">NaN</span></code> values with some other value using the <code class="docutils literal notranslate"><span class="pre">.fillna()</span></code> function. Let’s instead fill the missing values in our data set the with value <code class="docutils literal notranslate"><span class="pre">-9999</span></code>. Note that we are not giving the <code class="docutils literal notranslate"><span class="pre">subset</span></code> parameter this time.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">warm_temps</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="o">-</span><span class="mi">9999</span><span class="p">)</span>
</pre></div>
</div>
<!-- #region deletable=true editable=true slideshow={"slide_type": ""} -->
<p>As a result we now have a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> where all <code class="docutils literal notranslate"><span class="pre">NaN</span></code> values in the DataFrame are filled with the value <code class="docutils literal notranslate"><span class="pre">-9999</span></code>. As was the case for the <code class="docutils literal notranslate"><span class="pre">.dropna()</span></code> function, you can fill values in select columns by directing the <code class="docutils literal notranslate"><span class="pre">.fillna()</span></code> function to a specific column (or set of columns).</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">warm_temps</span><span class="p">[</span><span class="s2">&quot;MIN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">warm_temps</span><span class="p">[</span><span class="s2">&quot;MIN&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="o">-</span><span class="mi">9999</span><span class="p">)</span>
<span class="n">warm_temps</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
<p>Notice that now the <code class="docutils literal notranslate"><span class="pre">NaN</span></code> value at index <code class="docutils literal notranslate"><span class="pre">82</span></code> of the <code class="docutils literal notranslate"><span class="pre">MIN</span></code> has been replaced, while the <code class="docutils literal notranslate"><span class="pre">NaN</span></code> value in the <code class="docutils literal notranslate"><span class="pre">DIFF</span></code> column remains.</p>
<p>It is important to be aware, that in many cases filling the data with a specific value is dangerous because you end up modifying the actual data, which might affect the results of your analysis. For example, in the case above we would have dramatically changed the temperature difference columns because the <code class="docutils literal notranslate"><span class="pre">-9999</span></code> values not an actual temperature! Hence, use caution when filling missing values. In some cases, you might have to fill in missing data values for the purpose of saving the data file in a specific format. For example, some GIS software cannot handle missing values. Always pay attention to potential missing data values when reading in data files and performing your data analysis.</p>
<!-- #endregion -->
<!-- #region editable=true slideshow={"slide_type": ""} -->
</section>
<section id="data-type-conversions">
<h2>Data type conversions<a class="headerlink" href="#data-type-conversions" title="Link to this heading">#</a></h2>
<!-- #endregion -->
<!-- #region editable=true slideshow={"slide_type": ""} -->
<p>When doing data analysis, another quite typical operation that needs to be done is to convert values in a column from one data type to another, such as from floating point values to integers. Remember, that we have already performed data type conversions in Chapter 2 using built-in Python functions such as <code class="docutils literal notranslate"><span class="pre">int()</span></code> or <code class="docutils literal notranslate"><span class="pre">str()</span></code>. For values stored in a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> <code class="docutils literal notranslate"><span class="pre">Series</span></code>, we can use the <code class="docutils literal notranslate"><span class="pre">.astype()</span></code> method for converting data types. Let’s explore this by converting the temperature values (type <code class="docutils literal notranslate"><span class="pre">float64</span></code>) in the column <code class="docutils literal notranslate"><span class="pre">TEMP</span></code> to be integers (type <code class="docutils literal notranslate"><span class="pre">int64</span></code>). Let’s first have a look at the existing data.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;TEMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
<p>Now we can easily convert those decimal values to integers using <code class="docutils literal notranslate"><span class="pre">.astype(int)</span></code>.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;TEMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
<p>Great! As we can see the values were converted to integers. However, this example demonstrates the importance of being careful with type conversions from floating point values to integers. This type conversion simply drops the stuff to the right of the decimal point, so all values are effectively rounded down to the nearest whole number. For example, the first value in our <code class="docutils literal notranslate"><span class="pre">Series</span></code> (<code class="docutils literal notranslate"><span class="pre">23.7</span></code>) was truncated to <code class="docutils literal notranslate"><span class="pre">23</span></code> as an integer when it clearly should be rounded up to <code class="docutils literal notranslate"><span class="pre">24</span></code>. This issue can be resolved by chaining together the <code class="docutils literal notranslate"><span class="pre">.round()</span></code> function with the <code class="docutils literal notranslate"><span class="pre">.astype()</span></code> function. For example, <code class="docutils literal notranslate"><span class="pre">.round(0).astype(int)</span></code> will first round the values to have zero decimal places and then converts those values into integers.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;TEMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
<p>As we can see, now the integer values are correctly rounded.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">.astype()</span></code> method supports converting between all basic Python data types (<code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">float</span></code>, <code class="docutils literal notranslate"><span class="pre">str</span></code>), but it also knows how to convert between more specific <code class="docutils literal notranslate"><span class="pre">numpy</span></code> data types such as <code class="docutils literal notranslate"><span class="pre">int64</span></code>, <code class="docutils literal notranslate"><span class="pre">int32</span></code>, <code class="docutils literal notranslate"><span class="pre">float64</span></code>, <code class="docutils literal notranslate"><span class="pre">float32</span></code> (a full list can be found in the <a class="reference external" href="https://numpy.org/doc/stable/user/basics.types.html">NumPy documentation</a> <a class="footnote-reference brackets" href="#numpydtypes" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a>). Using the <code class="docutils literal notranslate"><span class="pre">numpy</span></code> data type can useful if you need to be more specific about how many bits should be reserved for storing the values, for example. For instance, <code class="docutils literal notranslate"><span class="pre">int64</span></code> (i.e., a 64-bit integer) can store integer values ranging between -9223372036854775808 and 9223372036854775807, whereas <code class="docutils literal notranslate"><span class="pre">int16</span></code> can only store values from -32768 to 32767. If passing the “normal” <code class="docutils literal notranslate"><span class="pre">int</span></code> or <code class="docutils literal notranslate"><span class="pre">float</span></code> to the <code class="docutils literal notranslate"><span class="pre">astype()</span></code> function, <code class="docutils literal notranslate"><span class="pre">pandas</span></code> will automatically store 64-bit numeric values. However, higher the number precision (i.e., the larger number of bits you use), the more physical memory is required to store the data. Hence, in some specific cases dealing with extremely large datasets, it may be useful to be able to specify that the values in specific columns should be stored with lower precision to save memory.</p>
<!-- #endregion -->
<!-- #region editable=true slideshow={"slide_type": ""} -->
</section>
<section id="sorting-data">
<h2>Sorting data<a class="headerlink" href="#sorting-data" title="Link to this heading">#</a></h2>
<p>Quite often it is useful to be able to sort your data (descending/ascending) based on values in some column. This can be done easily with <code class="docutils literal notranslate"><span class="pre">pandas</span></code> using the <code class="docutils literal notranslate"><span class="pre">.sort_values(by='YourColumnName')</span></code> function. Let’s first sort the values in ascending order using the <code class="docutils literal notranslate"><span class="pre">TEMP</span></code> column.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sort DataFrame, ascending</span>
<span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;TEMP&quot;</span><span class="p">)</span>
</pre></div>
</div>
<!-- #region deletable=true editable=true slideshow={"slide_type": ""} -->
<p>Of course, it is also possible to sort them in descending order by including the <code class="docutils literal notranslate"><span class="pre">ascending=False</span></code> parameter.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sort DataFrame, descending</span>
<span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;TEMP&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
<p>In some situations, you might need to sort values based on multiple columns simultaneously, which is sometimes referred to as multi-level sorting. This can be done by passing a list of column names to the <code class="docutils literal notranslate"><span class="pre">by</span></code> parameter. When you sort the data based on multiple columns, sometimes you also might want to sort your data in a way that the first-level sorting happens in ascending order and the second-level sorting happens in descending order. An example situation for this kind of sorting could be when sorting the temperatures first by weekday (Monday, Tuesday, etc.) and then ordering the values for each weekday in descending order. This would always show the warmest temperature for a given day of the week first. Let’s modify our data a bit to demonstrate this. We will add a new column that has information about the weekday. The 1st of June, 2024 was a Saturday, so we start from that.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a list of weekdays that matches with our data</span>
<span class="c1"># The data covers 13 weeks + 1 day (altogether 92 days)</span>
<span class="n">week_days</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Sat&quot;</span><span class="p">,</span> <span class="s2">&quot;Sun&quot;</span><span class="p">,</span> <span class="s2">&quot;Mon&quot;</span><span class="p">,</span> <span class="s2">&quot;Tue&quot;</span><span class="p">,</span> <span class="s2">&quot;Wed&quot;</span><span class="p">,</span> <span class="s2">&quot;Thu&quot;</span><span class="p">,</span> <span class="s2">&quot;Fri&quot;</span><span class="p">]</span>
<span class="n">day_list</span> <span class="o">=</span> <span class="mi">13</span> <span class="o">*</span> <span class="n">week_days</span> <span class="o">+</span> <span class="n">week_days</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Add the weekdays to our DataFrame</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;WEEKDAY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">day_list</span>
<span class="n">data</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
<p>Now we have a new column with information about the weekday of each row. Next, we can test how to sort the values, so that we order the data by weekday and within each weekday the temperatures are in descending order. You can adjust how the ordering works by passing a list of Boolean values to the <code class="docutils literal notranslate"><span class="pre">ascending</span></code> parameter.</p>
<!-- #endregion -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;WEEKDAY&quot;</span><span class="p">,</span> <span class="s2">&quot;TEMP&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span>
</pre></div>
</div>
<!-- #region editable=true slideshow={"slide_type": ""} -->
<p>As a result the data are now ordered first by weekday (i.e., the same weekday values are grouped) and the within these weekdays the temperature values are sorted in descending order showing the warmest day first. Ordering data in this manner based on multiple criteria can sometimes be very useful when analyzing your data.</p>
<!-- #endregion -->
<!-- #region editable=true slideshow={"slide_type": ""} -->
</section>
<section id="table-join-combining-dataframes-using-a-common-key">
<h2>Table join: Combining DataFrames using a common key<a class="headerlink" href="#table-join-combining-dataframes-using-a-common-key" title="Link to this heading">#</a></h2>
<!-- #endregion -->
<section id="basic-logic-of-a-table-join">
<h3>Basic logic of a table join<a class="headerlink" href="#basic-logic-of-a-table-join" title="Link to this heading">#</a></h3>
<p>Joining data between two or more <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> objects is a common task when doing data analysis. The minimum requirement for being able to combine data between two (or more) <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> objects (or tables) is to have at least one common attribute (called a key) that is identical in both <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> objects. Figure 3.4 illustrates the logic of a table join. In this case, we want to merge the precipitation data from Kumpula weather station to the temperature data that we worked earlier in this chapter. The common key in this case is the time information in the <code class="docutils literal notranslate"><span class="pre">YEARMODA</span></code> column in the left <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> and the <code class="docutils literal notranslate"><span class="pre">Date</span></code> column in the right <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. The column names of the keys can be different (as in our case), but the values stored in these columns should correspond to each other so that it is possible to match the records between tables. The attribute values of the key can contain data in any format (dates, text, numbers, etc.). Hence, the data is not limited to dates or integers as demonstrated in this example.</p>
<p><img alt="Figure 3.4. Joining precipitation data from the right DataFrame to the left based on common key." src="part1/chapter-03/img/Table-join.png" /></p>
<p><em><strong>Figure 3.4</strong>. Joining precipitation data from the right DataFrame to the left based on common key.</em></p>
</section>
<section id="table-join-using-pandas-merge">
<h3>Table join using pandas <code class="docutils literal notranslate"><span class="pre">.merge()</span></code><a class="headerlink" href="#table-join-using-pandas-merge" title="Link to this heading">#</a></h3>
<p>In the following example, we first read some precipitation data for the Kumpula weather station and then join this data with the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> containing the average temperature data we have worked with. Merging two <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> objects together based on a common key (or multiple keys) can be done easily with <code class="docutils literal notranslate"><span class="pre">pandas</span></code> using the <code class="docutils literal notranslate"><span class="pre">.merge()</span></code> function. The column that represents the key can be specified using the <code class="docutils literal notranslate"><span class="pre">on</span></code> parameter if the key column is identical in both <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> objects. In our case, the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> columns containing common values have different names. Thus, we need to separately specify the key for the left <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> using the parameter <code class="docutils literal notranslate"><span class="pre">left_on</span></code> and use the parameter <code class="docutils literal notranslate"><span class="pre">right_on</span></code> for the right <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read precipitation data and show first rows</span>
<span class="n">precip</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/kumpula-temps-precip-summer-2024.txt&quot;</span><span class="p">)</span>
<span class="n">precip</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make a table join</span>
<span class="n">join</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">precip</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;YEARMODA&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">)</span>
<span class="n">join</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<p>Now we have merged all the information from the right <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> into the left one and stored the result in variable <code class="docutils literal notranslate"><span class="pre">join</span></code>. By doing this, we can analyze the relationship between the daily average temperature and precipitation, for example, to understand whether the temperature is lower when it rains. Currently, however, the <code class="docutils literal notranslate"><span class="pre">join</span></code> <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> also contains some variables that are not necessarily useful for us. A useful trick to do when joining is to limit the number of columns that will be kept from the right <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. This can be done by chaining a simple column selection while doing the merge as shown next. When doing this, it is important to remember that the <code class="docutils literal notranslate"><span class="pre">key</span></code> column on the right <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> must be part of the selection for the table join to work.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make another join but only keep the attribute of interest</span>
<span class="n">join2</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">precip</span><span class="p">[[</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="s2">&quot;Precipitation amount [mm]&quot;</span><span class="p">]],</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;YEARMODA&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span>
<span class="p">)</span>
<span class="n">join2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<p>As can be seen in the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> above, now only the column <code class="docutils literal notranslate"><span class="pre">Date</span></code> and the attribute of interest <code class="docutils literal notranslate"><span class="pre">Precipitation</span> <span class="pre">amount</span> <span class="pre">[mm]</span></code> were joined and kept in the output from the right <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. A similar trick can also be applied to the left <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> by adding the selection before the <code class="docutils literal notranslate"><span class="pre">.merge()</span></code> call.</p>
<p>In our case, doing the table join was fairly straightforward because we had only one unique record per day in both <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> objects. However, in some cases you might have multiple records in one or the other of the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> objects (e.g., hourly observations vs. daily observations). This can in specific cases cause issues (not always!), incorrect analysis results, and other undesired consequences if not taken into account properly. This kind of mismatch in number of records per table can be handled by first aggregating the hourly data to a daily average, for example. You can learn more about these aggregation techniques in the following sections.</p>
<!-- #region editable=true slideshow={"slide_type": ""} -->
</section>
</section>
<section id="footnotes">
<h2>Footnotes<a class="headerlink" href="#footnotes" title="Link to this heading">#</a></h2>
<!-- #endregion -->
<hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="loc" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.loc.html">https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.loc.html</a></p>
</aside>
<aside class="footnote brackets" id="at" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.at.html">https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.at.html</a></p>
</aside>
<aside class="footnote brackets" id="iloc" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">3</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iloc.html">https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iloc.html</a></p>
</aside>
<aside class="footnote brackets" id="isin" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">4</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.isin.html">https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.isin.html</a></p>
</aside>
<aside class="footnote brackets" id="numpydtypes" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">5</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://numpy.org/doc/stable/user/basics.types.html">https://numpy.org/doc/stable/user/basics.types.html</a></p>
</aside>
</aside>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-calculations">Basic calculations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#question-3-4">Question 3.4</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#selecting-and-updating-data">Selecting and updating data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#selecting-rows-and-columns">Selecting rows and columns</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#question-3-5">Question 3.5</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#selecting-a-single-row-or-value">Selecting a single row or value</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#selections-based-on-index-positions">Selections based on index positions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#selections-using-listed-criteria">Selections using listed criteria</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conditional-selections">Conditional selections</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#question-3-6">Question 3.6</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#view-versus-a-copy">View versus a copy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dealing-with-missing-data">Dealing with missing data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-type-conversions">Data type conversions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sorting-data">Sorting data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-join-combining-dataframes-using-a-common-key">Table join: Combining DataFrames using a common key</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-logic-of-a-table-join">Basic logic of a table join</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#table-join-using-pandas-merge">Table join using pandas <code class="docutils literal notranslate"><span class="pre">.merge()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#footnotes">Footnotes</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Henrikki Tenkanen, Vuokko Heikinheimo, David Whipp
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2020-2024, Henrikki Tenkanen, Vuokko Heikinheimo, David Whipp.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>