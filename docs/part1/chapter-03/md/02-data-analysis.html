

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Data wrangling, grouping and aggregation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/pythongis.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom-toggle-button.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'part1/chapter-03/md/02-data-analysis';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/pythongis-logo.png" class="logo__image only-light" alt=" - Home"/>
    <script>document.write(`<img src="../../../_static/pythongis-logo.png" class="logo__image only-dark" alt=" - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Part I - Python essentials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../chapter-01/index.html">1: Getting started</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-01/nb/00-motivation.html">Motivation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-01/nb/01-computers-and-programs.html">Computers and programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-01/nb/02-why-python.html">Why Python?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-01/nb/03-writing-and-running-python-code.html">Writing and running Python code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-01/nb/04-using-jupyterlab.html">Using JupyterLab for writing code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-01/nb/05-quick-start.html">Quickly getting started (without installing Python)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-01/nb/06-installation.html">Installing Python and adding libraries</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../chapter-02/index.html">2: Basic programming concepts</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-02/nb/00-python-basics.html">Basic elements of Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-02/nb/01-for-loops.html">for loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-02/nb/02-conditional-statements.html">Conditional statements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-02/nb/03-functions.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-02/nb/04-writing-scripts.html">Writing script files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-02/nb/05-modules.html">Loading and using modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-02/nb/06-exercises.html">Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../index.html">3: Introduction to data analysis</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../nb/00-pandas-basics.html">Getting started with data analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nb/01-data-manipulation.html">Common tabular operations in pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nb/02-data-analysis.html">Data wrangling, grouping and aggregation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nb/03-temporal-data.html">Working with temporal data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nb/04-exercises.html">Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../chapter-04/index.html">4: Introduction to data visualization</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-04/nb/00-plotting-in-python.html">Plotting in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-04/nb/01-basic-plotting.html">Plotting with pandas and matplotlib</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-04/nb/02-subplots.html">Creating subplots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-04/nb/03-plot-formatting.html">Effective plot design: line plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapter-04/nb/04-exercises.html">Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part II - Introduction to GIS with Python</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../part2/chapter-05/index.html">5: Getting started</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-05/nb/00-motivation-to-use-python-for-gis.html">Motivation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-05/nb/01-introduction-to-geographic-data-in-python.html">Geographic data in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-05/nb/02-introduction-to-coordinate-reference-systems.html">Coordinate reference systems</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../part2/chapter-06/index.html">6: Vector data processing</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-06/nb/00-introduction-to-geographic-objects.html">Introduction to geographic data objects in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-06/nb/01-introduction-to-geopandas.html">Introduction to spatial data analysis with geopandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-06/nb/02-data-io.html">Preparing GeoDataFrames from geographic data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-06/nb/03-geometric-manipulation.html">Geometric data manipulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-06/nb/04-coordinate-reference-system.html">Working with Map Projections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-06/nb/05-geocoding.html">Geocoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-06/nb/06-operations-between-multiple-datasets.html">Operations between multiple datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-06/nb/07-exercises.html">Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../part2/chapter-07/index.html">7: Raster data processing</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-07/nb/00-introduction-to-raster-analysis.html">Introduction to raster processing with Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-07/nb/01-reading-raster.html">Reading raster files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-07/nb/02-common-raster-operations.html">Common raster operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-07/nb/03-raster-operations-between-multiple-layers.html">Raster operations between multiple layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-07/nb/04-exercises.html">Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../part2/chapter-08/index.html">8: Geographic data visualization</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-08/nb/00-introduction-to-geographic-visualization.html">Introduction to geographic visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-08/nb/01-static-vector-maps.html">Static maps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-08/nb/02-static-raster-maps.html">Visualizing raster layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-08/nb/03-interactive-maps.html">Interactive maps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-08/nb/04-map-design-principles-and-colors.html">Designing maps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-08/nb/05-exercises.html">Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../part2/chapter-09/index.html">9: Using online geographic data sources</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-09/nb/00-retrieving-osm-data.html">Retrieving OpenStreetMap data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-09/nb/01-retrieving-data-from-wfs.html">Retrieving data from Web Feature Service (WFS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-09/nb/02-retrieving-data-from-wcs.html">Retrieving data from Web Coverage Service (WCS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-09/nb/03-read-data-from-spatial-databases.html">Reading data from spatial databases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part2/chapter-09/nb/04-exercises.html">Exercises</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part III - Case studies</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../part3/chapter-10/index.html">10: Spatial interpolation</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../part3/chapter-10/nb/00-introduction-to-spatial-interpolation.html">Introduction to spatial interpolation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part3/chapter-10/nb/01-inverse-distance-weighting.html">Inverse Distance Weighting interpolation with Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part3/chapter-10/nb/02-exercises.html">Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../part3/chapter-11/index.html">11: Spatial network analysis</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../part3/chapter-11/nb/00-introduction-to-spatial-network-analysis.html">Introduction to spatial network analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part3/chapter-11/nb/02-multimodal-spatial-accessibility-modelling.html">Multimodal spatial accessibility analysis with Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part3/chapter-11/nb/03-exercises.html">Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../part3/chapter-12/index.html">12: Terrain analysis</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../part3/chapter-12/nb/00-introduction-to-terrain-analysis.html">Introduction to terrain analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part3/chapter-12/nb/01-interpreting-topographic-features.html">Interpreting topographic features from raster data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../part3/chapter-12/nb/02-exercises.html">Exercises</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../part3/chapter-13/index.html">13: Conclusions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Back matter</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../back-matter/nb/acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../back-matter/appendices.html">Appendices</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../back-matter/nb/appendix-1.html">Version control with git</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../back-matter/nb/appendix-2.html">Collaborative coding with GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../back-matter/nb/appendix-3.html">Using Python script files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../back-matter/nb/appendix-4.html">Testing and debugging your code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../back-matter/nb/appendix-5.html">Solutions to questions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../back-matter/nb/appendix-6.html">Exercise solutions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../back-matter/nb/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../back-matter/nb/references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">About the authors</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Datasets</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../data/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data/noaa-data.html">NOAA Weather data</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/Python-GIS-book/site/edit/main/part1/chapter-03/md/02-data-analysis.md" target="_blank"
   class="btn btn-sm btn-source-edit-button"
   title="Suggest edit"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/part1/chapter-03/md/02-data-analysis.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Data wrangling, grouping and aggregation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cleaning-data-while-reading">Cleaning data while reading</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#renaming-columns">Renaming columns</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-functions-with-pandas">Using functions with pandas</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-a-function">Defining a function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-a-function-by-iterating-over-rows">Using a function by iterating over rows</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-a-function-with-apply">Using a function with apply</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#string-slicing">String slicing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#question-3-5">Question 3.5</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#grouping-and-aggregating-data">Grouping and aggregating data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-logic-of-grouping-a-dataframe-using-groupby">Basic logic of grouping a DataFrame using <code class="docutils literal notranslate"><span class="pre">.groupby()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aggregating-data-with-groupby">Aggregating data with <code class="docutils literal notranslate"><span class="pre">groupby()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#case-study-detecting-warm-months">Case study: Detecting warm months</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#automating-the-analysis">Automating the analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#managing-and-listing-filesystem-paths">Managing and listing filesystem paths</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iterate-over-input-files-and-repeat-the-analysis">Iterate over input files and repeat the analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#footnotes">Footnotes</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="data-wrangling-grouping-and-aggregation">
<h1>Data wrangling, grouping and aggregation<a class="headerlink" href="#data-wrangling-grouping-and-aggregation" title="Permalink to this heading">#</a></h1>
<p>Next, we will continue working with weather data, but expand our analysis to cover longer periods of data from Finland. In the following, you will learn various useful techniques in pandas to manipulate, group and aggregate the data in different ways that are useful when extracting insights from your data. In the end, you will learn how to create an automated data analysis workflow that can be repeated with multiple input files having a similar structure. As a case study, we will investigate whether January 2020 was the warmest month on record also in Finland, as the month was the warmest one on record globally <a class="footnote-reference brackets" href="#noaanews" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.</p>
<section id="cleaning-data-while-reading">
<h2>Cleaning data while reading<a class="headerlink" href="#cleaning-data-while-reading" title="Permalink to this heading">#</a></h2>
<p>In this section we are using weather observation data from Finland that was downloaded from NOAA (see <code class="docutils literal notranslate"><span class="pre">Datasets</span></code> chapter for further details). The input data is separated with varying number of spaces (i.e., fixed width). The first lines and columns of the data look like following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">USAF</span>  <span class="n">WBAN</span> <span class="n">YR</span><span class="o">--</span><span class="n">MODAHRMN</span> <span class="n">DIR</span> <span class="n">SPD</span> <span class="n">GUS</span> <span class="n">CLG</span> <span class="n">SKC</span> <span class="n">L</span> <span class="n">M</span> <span class="n">H</span>  <span class="n">VSB</span> <span class="n">MW</span> <span class="n">MW</span> <span class="n">MW</span> <span class="n">MW</span> <span class="n">AW</span>  <span class="o">...</span>
<span class="mi">029440</span> <span class="mi">99999</span> <span class="mi">190601010600</span> <span class="mi">090</span>   <span class="mi">7</span> <span class="o">***</span> <span class="o">***</span> <span class="n">OVC</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span>  <span class="mf">0.0</span> <span class="o">**</span> <span class="o">**</span> <span class="o">**</span> <span class="o">**</span> <span class="o">**</span>  <span class="o">...</span>
<span class="mi">029440</span> <span class="mi">99999</span> <span class="mi">190601011300</span> <span class="o">***</span>   <span class="mi">0</span> <span class="o">***</span> <span class="o">***</span> <span class="n">OVC</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span>  <span class="mf">0.0</span> <span class="o">**</span> <span class="o">**</span> <span class="o">**</span> <span class="o">**</span> <span class="o">**</span>  <span class="o">...</span>
<span class="mi">029440</span> <span class="mi">99999</span> <span class="mi">190601012000</span> <span class="o">***</span>   <span class="mi">0</span> <span class="o">***</span> <span class="o">***</span> <span class="n">OVC</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span>  <span class="mf">0.0</span> <span class="o">**</span> <span class="o">**</span> <span class="o">**</span> <span class="o">**</span> <span class="o">**</span>  <span class="o">...</span>
<span class="mi">029440</span> <span class="mi">99999</span> <span class="mi">190601020600</span> <span class="o">***</span>   <span class="mi">0</span> <span class="o">***</span> <span class="o">***</span> <span class="n">CLR</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span>  <span class="mf">0.0</span> <span class="o">**</span> <span class="o">**</span> <span class="o">**</span> <span class="o">**</span> <span class="o">**</span>  <span class="o">...</span>
</pre></div>
</div>
<p>By looking at the data, we can notice a few things that we need to consider when reading the data:</p>
<ol class="arabic simple">
<li><p><strong>Delimiter:</strong> The columns are separated with a varying amount of spaces which requires using some special tricks when reading the data with pandas <code class="docutils literal notranslate"><span class="pre">read_csv()</span></code> function</p></li>
<li><p><strong>NoData values:</strong> NaN values in the NOAA data are coded with varying number of <code class="docutils literal notranslate"><span class="pre">*</span></code> characters, hence, we need to be able to instruct pandas to interpret those as NaNs.</p></li>
<li><p><strong>Many columns</strong>: The input data contains many columns (altogether 33). Many of those do not contain any meaningful data for our needs. Hence, we should probably ignore the unnecessary columns already at this stage.</p></li>
</ol>
<p>Handling and cleaning heterogeneous input data (such as our example here) can be done after reading in the data. However, in many cases, it is actually useful to do some cleaning and preprocessing already when reading the data. In fact, that is often much easier to do. In our case, we can read the data with varying number of spaces between the columns (1) by using a parameter <code class="docutils literal notranslate"><span class="pre">delim_whitespace=True</span></code> (alternatively, specifying <code class="docutils literal notranslate"><span class="pre">sep='\s+'</span></code> would work). For handling the NoData values (2), we can tell pandas to consider the <code class="docutils literal notranslate"><span class="pre">*</span></code> characters as NaNs by using a paramater <code class="docutils literal notranslate"><span class="pre">na_values</span></code> and specifying a list of characters that should be converted to NaNs. Hence, in this case we can specify <code class="docutils literal notranslate"><span class="pre">na_values=['*',</span> <span class="pre">'**',</span> <span class="pre">'***',</span> <span class="pre">'****',</span> <span class="pre">'*****',</span> <span class="pre">'******']</span></code> which will then convert the varying number of <code class="docutils literal notranslate"><span class="pre">*</span></code> characters into NaN values. Finally, we can limit the number of columns that we read (3) by using the <code class="docutils literal notranslate"><span class="pre">usecols</span></code> parameter, which we already used previously. In our case, we are interested in columns that might be somehow useful to our analysis (or at least meaningful to us), including e.g. the station name, timestamp, and data about the wind and temperature: <code class="docutils literal notranslate"><span class="pre">'USAF','YR--MODAHRMN',</span> <span class="pre">'DIR',</span> <span class="pre">'SPD',</span> <span class="pre">'GUS','TEMP',</span> <span class="pre">'MAX',</span> <span class="pre">'MIN'</span></code>. Achieving all these things is pretty straightforward using the <code class="docutils literal notranslate"><span class="pre">read_csv()</span></code> function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Define relative path to the file</span>
<span class="n">fp</span> <span class="o">=</span> <span class="s2">&quot;data/029820.txt&quot;</span>

<span class="c1"># Read data using varying amount of spaces as separator,</span>
<span class="c1"># specifying &#39;*&#39; characters as NoData values,</span>
<span class="c1"># and selecting only specific columns from the data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">fp</span><span class="p">,</span>
    <span class="n">delim_whitespace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">na_values</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;**&quot;</span><span class="p">,</span> <span class="s2">&quot;***&quot;</span><span class="p">,</span> <span class="s2">&quot;****&quot;</span><span class="p">,</span> <span class="s2">&quot;*****&quot;</span><span class="p">,</span> <span class="s2">&quot;******&quot;</span><span class="p">],</span>
    <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;USAF&quot;</span><span class="p">,</span> <span class="s2">&quot;YR--MODAHRMN&quot;</span><span class="p">,</span> <span class="s2">&quot;DIR&quot;</span><span class="p">,</span> <span class="s2">&quot;SPD&quot;</span><span class="p">,</span> <span class="s2">&quot;GUS&quot;</span><span class="p">,</span> <span class="s2">&quot;TEMP&quot;</span><span class="p">,</span> <span class="s2">&quot;MAX&quot;</span><span class="p">,</span> <span class="s2">&quot;MIN&quot;</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Let’s see now how the data looks by printing the first five rows with the <code class="docutils literal notranslate"><span class="pre">head()</span></code> function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<p>Perfect, looks good. We have skipped a bunch of unnecessary columns and also the asterisk (*) characters have been correctly converted to NaN values.</p>
</section>
<section id="renaming-columns">
<h2>Renaming columns<a class="headerlink" href="#renaming-columns" title="Permalink to this heading">#</a></h2>
<p>Let’s take a closer look at the column names of our DataFrame:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
<p>As we see, some of the column names are a bit awkward and difficult to interpret (a description for the columns is available in the metadata <span class="xref myst">data/3505doc.txt</span>). Luckily, it is easy to alter labels in a pandas DataFrame using the <code class="docutils literal notranslate"><span class="pre">rename()</span></code> function. In order to change the column names, we need to tell pandas how we want to rename the columns using a dictionary that converts the old names to new ones. As you probably remember from Chapter 1, a <code class="docutils literal notranslate"><span class="pre">dictionary</span></code> is a specific data structure in Python for storing key-value pairs. We can define the new column names using a dictionary where we list “<code class="docutils literal notranslate"><span class="pre">key:</span> <span class="pre">value</span></code>” pairs in following manner:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">USAF</span></code>: <code class="docutils literal notranslate"><span class="pre">STATION_NUMBER</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">YR--MODAHRMN</span></code>: <code class="docutils literal notranslate"><span class="pre">TIME</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SPD</span></code>: <code class="docutils literal notranslate"><span class="pre">SPEED</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GUS</span></code>: <code class="docutils literal notranslate"><span class="pre">GUST</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TEMP</span></code>: <code class="docutils literal notranslate"><span class="pre">TEMP_F</span></code></p></li>
</ul>
<p>Hence, the original column name (e.g. <code class="docutils literal notranslate"><span class="pre">YR--MODAHRMN</span></code>) is the dictionary <code class="docutils literal notranslate"><span class="pre">key</span></code> which will be converted to a new column name <code class="docutils literal notranslate"><span class="pre">TIME</span></code> (which is the <code class="docutils literal notranslate"><span class="pre">value</span></code>). The temperature values in our data file is again represented in Fahrenheit. We will soon convert these temperatures to Celsius. Hence, in order to avoid confusion with the columns, let’s rename the column <code class="docutils literal notranslate"><span class="pre">TEMP</span></code> to <code class="docutils literal notranslate"><span class="pre">TEMP_F</span></code>. Also the station number <code class="docutils literal notranslate"><span class="pre">USAF</span></code> is much more intuitive if we call it <code class="docutils literal notranslate"><span class="pre">STATION_NUMBER</span></code>. Let’s create a dictionary for the new column names:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">new_names</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;USAF&quot;</span><span class="p">:</span> <span class="s2">&quot;STATION_NUMBER&quot;</span><span class="p">,</span>
    <span class="s2">&quot;YR--MODAHRMN&quot;</span><span class="p">:</span> <span class="s2">&quot;TIME&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SPD&quot;</span><span class="p">:</span> <span class="s2">&quot;SPEED&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GUS&quot;</span><span class="p">:</span> <span class="s2">&quot;GUST&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TEMP&quot;</span><span class="p">:</span> <span class="s2">&quot;TEMP_F&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">new_names</span>
</pre></div>
</div>
<p>Our dictionary looks correct, so now we can change the column names by passing that dictionary using the parameter <code class="docutils literal notranslate"><span class="pre">columns</span></code> in the <code class="docutils literal notranslate"><span class="pre">rename()</span></code> function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">new_names</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
<p>Perfect, now our column names are easier to understand and use.</p>
</section>
<section id="using-functions-with-pandas">
<h2>Using functions with pandas<a class="headerlink" href="#using-functions-with-pandas" title="Permalink to this heading">#</a></h2>
<p>Now it’s time to convert those temperatures from Fahrenheit to Celsius. We have done this many times before, but this time we will learn how to apply our own functions to data in a pandas DataFrame. We will define a function for the temperature conversion, and apply this function for each Celsius value on each row of the DataFrame. Output celsius values should be stored in a new column called <code class="docutils literal notranslate"><span class="pre">TEMP_C</span></code>. But first, it is a good idea to check some basic properties of our new input data before proceeding with data analysis:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># First rows</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Last rows</span>
<span class="n">data</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data types</span>
<span class="n">data</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
<p>Nothing suspicous for the first and last rows, but here with <code class="docutils literal notranslate"><span class="pre">info()</span></code> we can see that the number of observations per column seem to be varying if you compare the <code class="docutils literal notranslate"><span class="pre">Non-Null</span> <span class="pre">Count</span></code> information to the number of entries in the data (N=198334). Only station number and time seem to have data on each row. All other columns seem to have some missing values. This is not necessarily anything dangerous, but good to keep in mind. Let’s still look at the descriptive statistics:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Descriptive stats</span>
<span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
<p>By looking at the <code class="docutils literal notranslate"><span class="pre">TEMP_F</span></code> values (Fahrenheit temperatures), we can confirm that our measurements seems more or less valid because the value range of the temperatures makes sense, i.e. there are no outliers such as extremely high <code class="docutils literal notranslate"><span class="pre">MAX</span></code> values or low <code class="docutils literal notranslate"><span class="pre">MIN</span></code> values. It is always a good practice to critically check your data before doing any analysis, as it is possible that your data may include incorrect values, e.g. due to a sensor malfunction or human error.</p>
<section id="defining-a-function">
<h3>Defining a function<a class="headerlink" href="#defining-a-function" title="Permalink to this heading">#</a></h3>
<p>Now we are sure that our data looks okay, and we can start our temperature conversion process by first defining our temperature conversion function from Fahrenheit to Celsius. Pandas can use regular functions, hence you can define functions for pandas exactly in the same way as you would do normally (as we learned in Chapter 1). Hence, let’s define a function that converts Fahrenheits to Celsius:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fahr_to_celsius</span><span class="p">(</span><span class="n">temp_fahrenheit</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to convert Fahrenheit temperature into Celsius.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    temp_fahrenheit: int | float</span>
<span class="sd">        Input temperature in Fahrenheit (should be a number)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    Temperature in Celsius (float)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Convert the Fahrenheit into Celsius</span>
    <span class="n">converted_temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp_fahrenheit</span> <span class="o">-</span> <span class="mi">32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.8</span>

    <span class="k">return</span> <span class="n">converted_temp</span>
</pre></div>
</div>
<p>Now we have the function defined and stored in memory. At this point it is good to test the function with some known value:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fahr_to_celsius</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
</pre></div>
</div>
<p>32 Fahrenheits is indeed 0 Celsius, so our function seem to be working correctly.</p>
</section>
<section id="using-a-function-by-iterating-over-rows">
<h3>Using a function by iterating over rows<a class="headerlink" href="#using-a-function-by-iterating-over-rows" title="Permalink to this heading">#</a></h3>
<p>Next we will learn how to use our function with data stored in pandas DataFrame. We will first apply the function row-by-row using a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop and then we will learn a more efficient way of applying the function to all rows at once.</p>
<p>Looping over rows in a DataFrame can be done in a couple of different ways. A common approach is to use a <code class="docutils literal notranslate"><span class="pre">iterrows()</span></code> method which loops over the rows as a index-Series pairs. In other words, we can use the <code class="docutils literal notranslate"><span class="pre">iterrows()</span></code> method together with a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop to repeat a process <em>for each row in a Pandas DataFrame</em>. Please note that iterating over rows this way is a rather inefficient approach, but it is still useful to understand the logic behind the iteration (we will learn a more efficient approach later). When using the <code class="docutils literal notranslate"><span class="pre">iterrows()</span></code> method it is important to understand that <code class="docutils literal notranslate"><span class="pre">iterrows()</span></code> accesses not only the values of one row, but also the <code class="docutils literal notranslate"><span class="pre">index</span></code> of the row as we mentioned. Let’s start with a simple for loop that goes through each row in our DataFrame:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Iterate over the rows</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="c1"># Print the index value</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Index:&quot;</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>

    <span class="c1"># Print the temperature from the row</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Temp F:&quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;TEMP_F&quot;</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">break</span>
</pre></div>
</div>
<p>We can see that the <code class="docutils literal notranslate"><span class="pre">idx</span></code> variable indeed contains the index value at position 0 (the first row) and the <code class="docutils literal notranslate"><span class="pre">row</span></code> variable contains all the data from that given row stored as a pandas <code class="docutils literal notranslate"><span class="pre">Series</span></code>. Notice, that when developing a for loop, you don’t always need to go through the entire loop if you just want to test things out. Using the <code class="docutils literal notranslate"><span class="pre">break</span></code> statement in Python terminates a loop whenever it is placed inside a loop. We used it here just to test check out the values on the first row. With a large data, you might not want to print out thousands of values to the screen!</p>
<p>Let’s now create an empty column <code class="docutils literal notranslate"><span class="pre">TEMP_C</span></code> for the Celsius temperatures and update the values in that column using the <code class="docutils literal notranslate"><span class="pre">fahr_to_celsius()</span></code> function that we defined earlier. For updating the value, we can use <code class="docutils literal notranslate"><span class="pre">at</span></code> which we already used earlier in this chapter. This time, we will use the <code class="docutils literal notranslate"><span class="pre">itertuples()</span></code> method which works in a similar manner, except it only return the row values without the <code class="docutils literal notranslate"><span class="pre">index</span></code>. When using <code class="docutils literal notranslate"><span class="pre">itertuples()</span></code> accessing the row values needs to be done a bit differently, because the row is not a Series, but a <code class="docutils literal notranslate"><span class="pre">named</span> <span class="pre">tuple</span></code> (hence the name). A tuple is like a list (but immutable, i.e. you cannot change it) and “named tuple” is a special kind of tuple object that adds the ability to access the values by name instead of position index. Hence, we will access the <code class="docutils literal notranslate"><span class="pre">TEMP_F</span></code> value by using <code class="docutils literal notranslate"><span class="pre">row.TEMP_F</span></code> (compare to how we accessed the value in the prevous code block):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an empty column for the output values</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;TEMP_C&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="c1"># Iterate over the rows</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
    <span class="c1"># Convert the Fahrenheit to Celsius</span>
    <span class="c1"># Notice how we access the row value</span>
    <span class="n">celsius</span> <span class="o">=</span> <span class="n">fahr_to_celsius</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">TEMP_F</span><span class="p">)</span>

    <span class="c1"># Update the value for &#39;Celsius&#39; column with the converted value</span>
    <span class="c1"># Notice how we can access the Index value</span>
    <span class="n">data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">Index</span><span class="p">,</span> <span class="s2">&quot;TEMP_C&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">celsius</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check the result</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># How does our row look like?</span>
<span class="n">row</span>
</pre></div>
</div>
<p>Okay, now we have iterated over our data and updated the temperatures in Celsius to <code class="docutils literal notranslate"><span class="pre">TEMP_C</span></code> column by using our <code class="docutils literal notranslate"><span class="pre">fahr_to_celsius()</span></code> function. The values look correct as 32 Fahrenheits indeed is 0 Celsius degrees, as can be seen on the second row. We also have here the last row of our DataFrame which is a named tuple. As you can see, it is a bit like a weird looking dictionary with values assigned to the names of our columns. Basically, it is an object with attributes that we can access in a similar manner as we have used to access some of the pandas DataFrame attributes, such as <code class="docutils literal notranslate"><span class="pre">data.shape</span></code>.</p>
<p>A couple of notes about our appoaches. We used <code class="docutils literal notranslate"><span class="pre">itertuples()</span></code> method for looping over the values because it is significantly faster compared to <code class="docutils literal notranslate"><span class="pre">iterrows()</span></code> (can be ~100x faster). We used <code class="docutils literal notranslate"><span class="pre">.at</span></code> to assign the value to the DataFrame because it is designed to access single values more efficiently compared to <code class="docutils literal notranslate"><span class="pre">.loc</span></code>, which can access also groups of rows and columns. That said, you could have used <code class="docutils literal notranslate"><span class="pre">data.loc[idx,</span> <span class="pre">new_column]</span> <span class="pre">=</span> <span class="pre">celsius</span></code> to achieve the same result (it is just slower).</p>
</section>
<section id="using-a-function-with-apply">
<h3>Using a function with apply<a class="headerlink" href="#using-a-function-with-apply" title="Permalink to this heading">#</a></h3>
<p>Although using for loop with <code class="docutils literal notranslate"><span class="pre">itertuples()</span></code> can be fairly efficient, pandas DataFrames and Series have a dedicated method called <code class="docutils literal notranslate"><span class="pre">apply()</span></code> for applying functions on columns (or rows). <code class="docutils literal notranslate"><span class="pre">apply()</span></code> is typically faster than <code class="docutils literal notranslate"><span class="pre">itertuples()</span></code>, especially if you have large number of rows, such as in our case. When using <code class="docutils literal notranslate"><span class="pre">apply()</span></code>, we pass the function that we want to use as an argument. Let’s start by applying the function to the <code class="docutils literal notranslate"><span class="pre">TEMP_F</span></code> column that contains the temperature values in Fahrenheit:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;TEMP_F&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">fahr_to_celsius</span><span class="p">)</span>
</pre></div>
</div>
<p>The results look logical. Notice how we passed the <code class="docutils literal notranslate"><span class="pre">fahr_to_celsius()</span></code> function without using the parentheses <code class="docutils literal notranslate"><span class="pre">()</span></code> after the name of the function. When using <code class="docutils literal notranslate"><span class="pre">apply</span></code>, you should always leave out the parentheses from the function that you use. Meaning that you should use <code class="docutils literal notranslate"><span class="pre">apply(fahr_to_celsius)</span></code> instead of <code class="docutils literal notranslate"><span class="pre">apply(fahr_to_celsius())</span></code>. Why? Because the <code class="docutils literal notranslate"><span class="pre">apply()</span></code> method will execute and use the function itself in the background when it operates with the data. If we would pass our function with the parentheses, the <code class="docutils literal notranslate"><span class="pre">fahr_to_celsius()</span></code> function would actually be executed once before the loop with <code class="docutils literal notranslate"><span class="pre">apply()</span></code> starts (hence becoming unusable), and that is not what we want. Our previous command only returned the Series of temperatures to the screen, but naturally we can also store them permanently into a new column (overwriting the old values):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;TEMP_C&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;TEMP_F&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">fahr_to_celsius</span><span class="p">)</span>
</pre></div>
</div>
<p>A nice thing with <code class="docutils literal notranslate"><span class="pre">apply()</span></code> is that we can also apply the function on several columns at once. Below, we also sort the values in descending order based on values in <code class="docutils literal notranslate"><span class="pre">MIN</span></code> column to see that applying our function really works:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;TEMP_F&quot;</span><span class="p">,</span> <span class="s2">&quot;MIN&quot;</span><span class="p">,</span> <span class="s2">&quot;MAX&quot;</span><span class="p">]</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">fahr_to_celsius</span><span class="p">)</span>
<span class="n">result</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;MIN&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<p>You can also directly store the outputs to new columns <code class="docutils literal notranslate"><span class="pre">'TEMP_C'</span></code>, <code class="docutils literal notranslate"><span class="pre">'MIN_C'</span></code>, <code class="docutils literal notranslate"><span class="pre">'MAX_C'</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;TEMP_F&quot;</span><span class="p">,</span> <span class="s2">&quot;MIN&quot;</span><span class="p">,</span> <span class="s2">&quot;MAX&quot;</span><span class="p">]</span>
<span class="n">data</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">fahr_to_celsius</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<p>In this section, we showed you a few different ways to iterate over rows in pandas and apply functions. The most important thing is that you understand the logic of how loops work and how you can use your own functions to modify the values in a pandas DataFrame. Whenever you need to loop over your data, we recommend using <code class="docutils literal notranslate"><span class="pre">.apply()</span></code> as it is typically the most efficient one in terms of execution time. However, remember that in most cases you do not actually need to use loops, but you can do calculations in a “vectorized manner” (which is the fastest way) as we learned previously when doing basic calculations in pandas.</p>
</section>
</section>
<section id="string-slicing">
<h2>String slicing<a class="headerlink" href="#string-slicing" title="Permalink to this heading">#</a></h2>
<p>We will eventually want to group our data based on month in order to see if the January temperatures in 2020 were higher than on average (which is the goal in our analysis as you might recall). Currently, the date and time information is stored in the column <code class="docutils literal notranslate"><span class="pre">TIME</span></code> that has a structure <code class="docutils literal notranslate"><span class="pre">yyyyMMddhhmm</span></code>. This is a typical timestamp format in which <code class="docutils literal notranslate"><span class="pre">yyyy</span></code> equals to year in four digit format, <code class="docutils literal notranslate"><span class="pre">MM</span></code> to month (two digits), <code class="docutils literal notranslate"><span class="pre">dd</span></code> days, <code class="docutils literal notranslate"><span class="pre">hh</span></code> hours and <code class="docutils literal notranslate"><span class="pre">mm</span></code> minutes. Let’s have a closer look at the date and time information we have by checking the values in that column, and their data type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;TIME&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;TIME&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">TIME</span></code> column contains several observations per day (and even several observations per hour). The timestamp for the first observation is <code class="docutils literal notranslate"><span class="pre">190601010600</span></code>, i.e. from 1st of January 1906 (way back!), and the timestamp for the latest observation is <code class="docutils literal notranslate"><span class="pre">201910012350</span></code>. As we can see, the data type (<code class="docutils literal notranslate"><span class="pre">dtype</span></code>) of our column seems to be <code class="docutils literal notranslate"><span class="pre">int64</span></code>, i.e. the information is stored as integer values.</p>
<p>We want to aggregate this data on a monthly level. In order to do so, we need to “label” each row of data based on the month when the record was observed. Hence, we need to somehow separate information about the year and month for each row. In practice, we can create a new column (or an index) containing information about the month (including the year, but excluding days, hours and minutes). There are different ways of achieving this, but here we will take advantage of <code class="docutils literal notranslate"><span class="pre">string</span> <span class="pre">slicing</span></code> which means that we convert the date and time information into character strings and “cut” the needed information from the string objects. The other option would be to convert the timestamp values into something called <code class="docutils literal notranslate"><span class="pre">datetime</span></code> objects, but we will learn about those a bit later. Before further processing, we first want to convert the <code class="docutils literal notranslate"><span class="pre">TIME</span></code> column as character strings for convenience, stored into a new column <code class="docutils literal notranslate"><span class="pre">TIME_STR</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;TIME_STR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;TIME&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</pre></div>
</div>
<p>If we look at the latest time stamp in the data (<code class="docutils literal notranslate"><span class="pre">201910012350</span></code>), you can see that there is a systematic pattern <code class="docutils literal notranslate"><span class="pre">YEAR-MONTH-DAY-HOUR-MINUTE</span></code>. Four first characters represent the year, and the following two characters represent month. Because we are interested in understanding monthly averages for different years, we want to slice the year and month values from the timestamp (the first 6 characters), like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">date</span> <span class="o">=</span> <span class="s2">&quot;201910012350&quot;</span>
<span class="n">date</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
</pre></div>
</div>
<p>Based on this information, we can slice the correct range of characters from the <code class="docutils literal notranslate"><span class="pre">TIME_STR</span></code> column using a specific pandas function designed for Series, called <code class="docutils literal notranslate"><span class="pre">.str.slice()</span></code>. As parameters, the function has <code class="docutils literal notranslate"><span class="pre">start</span></code> and <code class="docutils literal notranslate"><span class="pre">stop</span></code> which you can use to specify the positions where the slicing should start and end:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;YEAR_MONTH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;TIME_STR&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<p>Nice! Now we have “labeled” the rows based on information about day of the year and hour of the day.</p>
<section id="question-3-5">
<h3>Question 3.5<a class="headerlink" href="#question-3-5" title="Permalink to this heading">#</a></h3>
<p>Create a new column <code class="docutils literal notranslate"><span class="pre">'MONTH'</span></code> with information about the month without the year.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use this cell to enter your solution.</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">data</span><span class="p">[</span><span class="s2">&quot;MONTH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;TIME_STR&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="grouping-and-aggregating-data">
<h2>Grouping and aggregating data<a class="headerlink" href="#grouping-and-aggregating-data" title="Permalink to this heading">#</a></h2>
<section id="basic-logic-of-grouping-a-dataframe-using-groupby">
<h3>Basic logic of grouping a DataFrame using <code class="docutils literal notranslate"><span class="pre">.groupby()</span></code><a class="headerlink" href="#basic-logic-of-grouping-a-dataframe-using-groupby" title="Permalink to this heading">#</a></h3>
<p>In the following sections, we want to calculate the average temperature for each month in our dataset. Here, we will learn how to use a <code class="docutils literal notranslate"><span class="pre">.groupby()</span></code> method which is a handy tool for compressing large amounts of data and computing statistics for subgroups. We will use the groupby method to calculate the average temperatures for each month trough these three main steps:</p>
<ol class="arabic simple">
<li><p>group the data based on year and month using <code class="docutils literal notranslate"><span class="pre">groupby()</span></code></p></li>
<li><p>calculate the average temperature for each month (i.e. each group)</p></li>
<li><p>store the resulting rows into a DataFrame called <code class="docutils literal notranslate"><span class="pre">monthly_data</span></code></p></li>
</ol>
<p>We have quite a few rows of weather data (N=198334), and several observations per day. Our goal is to create an aggreated DataFrame that would have only one row per month. The <code class="docutils literal notranslate"><span class="pre">.groupby()</span></code> takes as a parameter the name of the column (or a list of columns) that you want to use as basis for doing the grouping.  Let’s start by grouping our data based on unique year and month combination:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">grouped</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;YEAR_MONTH&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice, thas it would also be possible to create combinations of years and months “on-the-fly” if you have them in separate columns. In such case, grouping the data could be done as <code class="docutils literal notranslate"><span class="pre">grouped</span> <span class="pre">=</span> <span class="pre">data.groupby(['YEAR',</span> <span class="pre">'MONTH'])</span></code>. Let’s explore the new variable <code class="docutils literal notranslate"><span class="pre">grouped</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">grouped</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grouped</span><span class="p">))</span>
</pre></div>
</div>
<p>We have a new object with type <code class="docutils literal notranslate"><span class="pre">DataFrameGroupBy</span></code> with 826 groups. In order to understand what just happened, let’s also check the number of unique year and month combinations in our data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;YEAR_MONTH&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</pre></div>
</div>
<p>Length of the grouped object should be the same as the number of unique values in the column we used for grouping (<code class="docutils literal notranslate"><span class="pre">YEAR_MONTH</span></code>). For each unique value, there is a group of data. Let’s explore our grouped data further by check the “names” of the groups (five first ones). Here, we access the <code class="docutils literal notranslate"><span class="pre">keys</span></code> of the groups and convert them to a <code class="docutils literal notranslate"><span class="pre">list</span></code> so that we can slice and print only a few of those to the sceen:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">grouped</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">())[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
<p>Let’s check the contents for a group representing January 1906. We can get the values for that month from the grouped object using the <code class="docutils literal notranslate"><span class="pre">get_group()</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specify a month (as character string)</span>
<span class="n">month</span> <span class="o">=</span> <span class="s2">&quot;190601&quot;</span>

<span class="c1"># Select the group</span>
<span class="n">group1</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">month</span><span class="p">)</span>
<span class="n">group1</span>
</pre></div>
</div>
<p>As we can see, a single group contains a DataFrame with values only for that specific month. Let’s check the DataType of this group:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">group1</span><span class="p">)</span>
</pre></div>
</div>
<p>So, one group is a pandas DataFrame which is really useful, because it allows us to use all the familiar DataFrame methods for calculating statistics etc. for this specific group which we will see shortly. It is also possible to iterate over the groups in our <code class="docutils literal notranslate"><span class="pre">DataFrameGroupBy</span></code> object which can be useful if you need to conduct and apply some more complicated subtasks for each group. When doing so, it is important to understand that a single group in our <code class="docutils literal notranslate"><span class="pre">DataFrameGroupBy</span></code> actually contains not only the actual values, but also information about the <code class="docutils literal notranslate"><span class="pre">key</span></code> that was used to do the grouping. Hence, when iterating we need to assign the <code class="docutils literal notranslate"><span class="pre">key</span></code> and the values (i.e. the group) into separate variables. Let’s see how we can iterate over the groups and print the key and the data from a single group (again using <code class="docutils literal notranslate"><span class="pre">break</span></code> to only see what is happening):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Iterate over groups</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped</span><span class="p">:</span>
    <span class="c1"># Print key and group</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Key:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">First rows of data in this group:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

    <span class="c1"># Stop iteration with break command</span>
    <span class="k">break</span>
</pre></div>
</div>
<p>Here, we can see that the <code class="docutils literal notranslate"><span class="pre">key</span></code> contains the name of the group (i.e. the unique value from <code class="docutils literal notranslate"><span class="pre">YEAR_MONTH</span></code>).</p>
</section>
<section id="aggregating-data-with-groupby">
<h3>Aggregating data with <code class="docutils literal notranslate"><span class="pre">groupby()</span></code><a class="headerlink" href="#aggregating-data-with-groupby" title="Permalink to this heading">#</a></h3>
<p>We can, for example, calculate the average values for all variables using the statistical functions that we have seen already (e.g. mean, std, min, max, median). To calculate the average temperature for each month, we can use the <code class="docutils literal notranslate"><span class="pre">mean()</span></code> function. Let’s calculate the mean for all the weather related data attributes in our group at once:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specify the columns that will be part of the calculation</span>
<span class="n">mean_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;DIR&quot;</span><span class="p">,</span> <span class="s2">&quot;SPEED&quot;</span><span class="p">,</span> <span class="s2">&quot;GUST&quot;</span><span class="p">,</span> <span class="s2">&quot;TEMP_F&quot;</span><span class="p">,</span> <span class="s2">&quot;TEMP_C&quot;</span><span class="p">]</span>

<span class="c1"># Calculate the mean values all at one go</span>
<span class="n">mean_values</span> <span class="o">=</span> <span class="n">group1</span><span class="p">[</span><span class="n">mean_cols</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">mean_values</span>
</pre></div>
</div>
<p>As a result, we get a pandas Series with mean values calculated for all columns in the group. Notice that if you want to convert this Series back into a DataFrame (which can be useful if you e.g. want to merge multiple groups), you can use command <code class="docutils literal notranslate"><span class="pre">.to_frame().T</span></code> which first converts the Series into a DataFrame and then transposes the order of the axes (the label names becomes the column names):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert to DataFrame</span>
<span class="n">mean_values</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
<p>To do a similar aggregation with all the groups in our data, we can actually combine the <code class="docutils literal notranslate"><span class="pre">groupby()</span></code> function with the aggregation step (such as taking the mean, median etc. of given columns), and finally restructure the resulting DataFrame a bit. This can be at first a bit harder to understand, but this is how you would do the grouping and aggregating the values as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The columns that we want to aggregate</span>
<span class="n">mean_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;DIR&quot;</span><span class="p">,</span> <span class="s2">&quot;SPEED&quot;</span><span class="p">,</span> <span class="s2">&quot;GUST&quot;</span><span class="p">,</span> <span class="s2">&quot;TEMP_F&quot;</span><span class="p">,</span> <span class="s2">&quot;TEMP_C&quot;</span><span class="p">]</span>

<span class="c1"># Group and aggregate the data with one line</span>
<span class="n">monthly_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;YEAR_MONTH&quot;</span><span class="p">)[</span><span class="n">mean_cols</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">monthly_data</span>
</pre></div>
</div>
<p>As we can see, aggregating the data in this way is fairly straightforward and fast process requiring merely a single command. So what did we actually do here? We i) grouped the data, ii) selected specific columns from the result (<code class="docutils literal notranslate"><span class="pre">mean_cols</span></code>), iii) calculated the mean for all of the selected columns of the groups, and finally 4) reset the index. Resetting the index at the end is not necessary, but by doing it, we turn the <code class="docutils literal notranslate"><span class="pre">YEAR_MONTH</span></code> values into a dedicated column in our data (which would be otherwise store as <code class="docutils literal notranslate"><span class="pre">index</span></code>) .</p>
<p>What might not be obvious from this example is the fact that hidden in the background, each group is actually iterated over and the aggregation step is repeated for each group. For you to better understand what happens, we will next repeat the same process by iterating over groups and eventually creating a DataFrame that will contain the mean values for all those weather attributes that we were interested in. In this approach, we will first iterate over the groups, then calculate the mean values,  store the result into a list, and finally merge the aggregated data into a DataFrame called <code class="docutils literal notranslate"><span class="pre">monthly_data</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an empty list for storing the aggregated rows/DataFrames</span>
<span class="n">data_container</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># The columns that we want to aggregate</span>
<span class="n">mean_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;DIR&quot;</span><span class="p">,</span> <span class="s2">&quot;SPEED&quot;</span><span class="p">,</span> <span class="s2">&quot;GUST&quot;</span><span class="p">,</span> <span class="s2">&quot;TEMP_F&quot;</span><span class="p">,</span> <span class="s2">&quot;TEMP_C&quot;</span><span class="p">]</span>

<span class="c1"># Iterate over the groups</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped</span><span class="p">:</span>
    <span class="c1"># Calculate mean</span>
    <span class="n">mean_values</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">mean_cols</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="c1"># Add the ´key´ (i.e. the date+time information) into the Series</span>
    <span class="n">mean_values</span><span class="p">[</span><span class="s2">&quot;YEAR_MONTH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>

    <span class="c1"># Convert the pd.Series into DataFrame and</span>
    <span class="c1"># append the aggregated values into a list as a DataFrame</span>
    <span class="n">data_container</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_values</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

<span class="c1"># After iterating all groups, merge the list of DataFrames</span>
<span class="n">monthly_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">data_container</span><span class="p">)</span>
<span class="n">monthly_data</span>
</pre></div>
</div>
<p>As a result, we get identical results as with the earlier approach that was done with a single line of code (except for the position of the <code class="docutils literal notranslate"><span class="pre">YEAR_MONTH</span></code> column).</p>
<p>So which approach should you use? From the performance point of view, we recommend using the first approach (i.e. chaining) which does not require you to create a separate for loop, and is highly performant. However, this approach might be a bit more difficult to read and comprehend (the loop might be easier). Also sometimes you want to include additional processing steps inside the loop which can be hard accomplish by chaining everything into a single command. Hence, it is useful to know both of these approaches for doing aggregations with the data.</p>
</section>
</section>
<section id="case-study-detecting-warm-months">
<h2>Case study: Detecting warm months<a class="headerlink" href="#case-study-detecting-warm-months" title="Permalink to this heading">#</a></h2>
<p>Now, we have aggregated our data on monthly level and all we need to do is to check which years had the warmest January temperatures. A simple approach is to select all January values from the data and check which group(s) have the highest mean value. Before doing this, let’s separate the month information from our timestamp following the same approach as previously we did when slicing the year-month combination:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">monthly_data</span><span class="p">[</span><span class="s2">&quot;MONTH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">monthly_data</span><span class="p">[</span><span class="s2">&quot;YEAR_MONTH&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">monthly_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<p>Now we can select the values for January from our data and store it into a new variable <code class="docutils literal notranslate"><span class="pre">january_data</span></code>. We will also check the highest temperature values by sorting the DataFrame in a descending order:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">january_data</span> <span class="o">=</span> <span class="n">monthly_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">monthly_data</span><span class="p">[</span><span class="s2">&quot;MONTH&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;01&quot;</span><span class="p">]</span>
<span class="n">january_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;TEMP_C&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<p>By looking at the order of <code class="docutils literal notranslate"><span class="pre">YEAR_MONTH</span></code> column, we can see that January 2020 indeed was on average the warmest month on record based on weather observations from Finland.</p>
</section>
<section id="automating-the-analysis">
<h2>Automating the analysis<a class="headerlink" href="#automating-the-analysis" title="Permalink to this heading">#</a></h2>
<p>Now we have learned how to aggregate data using pandas. average temperatures for each month based on hourly weather observations. One of the most useful aspects of programming, is the ability to automate processes and repeat analyses such as these for any number of weather stations (assuming the data structure is the same).</p>
<p>Hence, let’s now see how we can repeat the previous data analysis steps for 15 weather stations located in different parts of Finland containing data for five years (2015-2019). The idea is that we will repeat the process for each input file using a (rather long) for loop. We will use the most efficient alternatives of the previously represented approaches, and finally will store the results in a single DataFrame for all stations. We will learn how to manipulate filepaths in Python using the <code class="docutils literal notranslate"><span class="pre">pathlib</span></code> module and see how we can list our input files in the data directory <code class="docutils literal notranslate"><span class="pre">data/finnish_stations</span></code>. We will store those paths to a variable <code class="docutils literal notranslate"><span class="pre">file_list</span></code>, so that we can use the file paths easily in the later steps.</p>
<section id="managing-and-listing-filesystem-paths">
<h3>Managing and listing filesystem paths<a class="headerlink" href="#managing-and-listing-filesystem-paths" title="Permalink to this heading">#</a></h3>
<p>In Python there are two commonly used approaches to manage and manipulate filepaths, namely <code class="docutils literal notranslate"><span class="pre">os.path</span></code> sub-module and a newer <code class="docutils literal notranslate"><span class="pre">pathlib</span></code> module (available since Python 3.4) which we will demonstrate here.  The built-in module <code class="docutils literal notranslate"><span class="pre">pathlib</span></code> provides many useful functions for interacting and manipulating filepaths on your operating system. On the following, we have data in different sub-folders and we will learn how to use the <code class="docutils literal notranslate"><span class="pre">Path</span></code> class from the <code class="docutils literal notranslate"><span class="pre">pathlib</span></code> library to construct filepaths. Next, we will import and use the <code class="docutils literal notranslate"><span class="pre">Path</span></code> class and see how we can construct a filepath by joining a folder path and file name:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># Initialize the Path</span>
<span class="n">input_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;data/finnish_stations&quot;</span><span class="p">)</span>

<span class="c1"># Join folder path and filename</span>
<span class="n">fp</span> <span class="o">=</span> <span class="n">input_folder</span> <span class="o">/</span> <span class="s2">&quot;028360.txt&quot;</span>
<span class="n">fp</span>
</pre></div>
</div>
<p>Here, we first initialized the <code class="docutils literal notranslate"><span class="pre">Path</span></code> object and stored it in variable <code class="docutils literal notranslate"><span class="pre">input_folder</span></code> by passing a relative path as a string to directory where all our files are located. Then we created a full filepath to file <code class="docutils literal notranslate"><span class="pre">028360.txt</span></code> by adding a forward slash (<code class="docutils literal notranslate"><span class="pre">/</span></code>) character between the folder and the filename which joins them together (easy!). In this case, our end result is something called a <em><code class="docutils literal notranslate"><span class="pre">PosixPath</span></code></em> which is a filesystem path to a given file on Linux or Mac operating systems. If you would run the same commands on Windows machine, the end result would be a <em><code class="docutils literal notranslate"><span class="pre">WindowsPath</span></code></em>. Hence, the output depends on which operating system you are using. However, you do not need to worry about this, because both types of Paths work exactly the same, no matter which operating system you use.</p>
<p>Both the <code class="docutils literal notranslate"><span class="pre">Path</span></code> object that we stored in <code class="docutils literal notranslate"><span class="pre">input_folder</span></code> variable and the <code class="docutils literal notranslate"><span class="pre">PosixPath</span></code> object that we stored in variable <code class="docutils literal notranslate"><span class="pre">fp</span></code> are actually quite versatile creatures, and we can do many useful things with them. For instance, we can find the parent folder where the file is located, extract the filename from the full path, test whether the file or directory actually exists, find various properties of the file (such as size of the file or creation time), and so on:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fp</span><span class="o">.</span><span class="n">parent</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fp</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fp</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># File properties</span>
<span class="n">size_in_bytes</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span>
<span class="n">creation_time</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_ctime</span>
<span class="n">modified_time</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_mtime</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Size (bytes): </span><span class="si">{</span><span class="n">size_in_bytes</span><span class="si">}</span><span class="se">\n</span><span class="s2">Created (seconds since Epoch): </span><span class="si">{</span><span class="n">creation_time</span><span class="si">}</span><span class="se">\n</span><span class="s2">Modified (seconds since Epoch): </span><span class="si">{</span><span class="n">modified_time</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>There are also various other methods that you can do with <code class="docutils literal notranslate"><span class="pre">pathlib</span></code>, such as rename the files (<code class="docutils literal notranslate"><span class="pre">.rename()</span></code>) or create folders (<code class="docutils literal notranslate"><span class="pre">.mkdir()</span></code>). You can see all available methods from <code class="docutils literal notranslate"><span class="pre">pathlib</span></code> documentation <a class="footnote-reference brackets" href="#pathlib" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>. One of the most useful tools in <code class="docutils literal notranslate"><span class="pre">pathlib</span></code> is the ability to list all files within a given folder by using the method <code class="docutils literal notranslate"><span class="pre">.glob()</span></code> which also allows you to add specific search criteria for listing only specific files from the directory:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">file_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">input_folder</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;0*txt&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>Here, the result is stored into variable <code class="docutils literal notranslate"><span class="pre">file_list</span></code> as a list. By default, the <code class="docutils literal notranslate"><span class="pre">.glob()</span></code> produces something called a <code class="docutils literal notranslate"><span class="pre">generator</span></code> which is a “lazy iterator”, i.e. a special kind of function that allows you to iterate over items like a list, but without actually storing the data in memory. By enclosing the <code class="docutils literal notranslate"><span class="pre">.glob()</span></code> search functionality with <code class="docutils literal notranslate"><span class="pre">list()</span></code> we convert this generator into a normal Python list. Note that we’re using the * character as a wildcard, so any filename that starts with <code class="docutils literal notranslate"><span class="pre">0</span></code> and ends with <code class="docutils literal notranslate"><span class="pre">txt</span></code> will be added to the list of files. We specifically use the number <code class="docutils literal notranslate"><span class="pre">0</span></code> as the starting part for the search criteria to avoid having metadata files included in the list. Let’s take a look what we got as a result:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of files in the list:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_list</span><span class="p">))</span>
<span class="n">file_list</span>
</pre></div>
</div>
</section>
<section id="iterate-over-input-files-and-repeat-the-analysis">
<h3>Iterate over input files and repeat the analysis<a class="headerlink" href="#iterate-over-input-files-and-repeat-the-analysis" title="Permalink to this heading">#</a></h3>
<p>Now, we should have all the relevant file paths in the <code class="docutils literal notranslate"><span class="pre">file_list</span></code>, and we can loop over the list using a for loop (again we break the loop after first iteration):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">fp</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
    <span class="k">break</span>
</pre></div>
</div>
<p>The data that we have sampled is in regular CSV format which we can read easily with <code class="docutils literal notranslate"><span class="pre">pd.read_csv()</span></code> function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<p>Now we have all the file paths to our weather observation datasets in a list, and we can start iterating over them and repeat the analysis steps for each file separately. We keep all the analytical steps inside a loop so that all of them are repeated to different stations. Finally, we will store the warmest January for each station in a list called <code class="docutils literal notranslate"><span class="pre">results</span></code> using a regular Python’s <code class="docutils literal notranslate"><span class="pre">append()</span></code> method and merge the list of DataFrames into one by using <code class="docutils literal notranslate"><span class="pre">pd.concat()</span></code> function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># A list for storing the result</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Repeat the analysis steps for each input file:</span>
<span class="k">for</span> <span class="n">fp</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
    <span class="c1"># Read the data from CSV file</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>

    <span class="c1"># Rename the columns</span>
    <span class="n">new_names</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;USAF&quot;</span><span class="p">:</span> <span class="s2">&quot;STATION_NUMBER&quot;</span><span class="p">,</span>
        <span class="s2">&quot;YR--MODAHRMN&quot;</span><span class="p">:</span> <span class="s2">&quot;TIME&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SPD&quot;</span><span class="p">:</span> <span class="s2">&quot;SPEED&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GUS&quot;</span><span class="p">:</span> <span class="s2">&quot;GUST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TEMP&quot;</span><span class="p">:</span> <span class="s2">&quot;TEMP_F&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">new_names</span><span class="p">)</span>

    <span class="c1"># Print info about the current input file (useful to understand how the process advances):</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;STATION NUMBER: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;STATION_NUMBER&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="s2">NUMBER OF OBSERVATIONS: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Create column</span>
    <span class="n">col_name</span> <span class="o">=</span> <span class="s2">&quot;TEMP_C&quot;</span>
    <span class="n">data</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Convert tempetarues from Fahrenheits to Celsius</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;TEMP_C&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;TEMP_F&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">fahr_to_celsius</span><span class="p">)</span>

    <span class="c1"># Convert TIME to string</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;TIME_STR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;TIME&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="c1"># Parse year and month and convert them to numbers</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;MONTH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;TIME_STR&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;YEAR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;TIME_STR&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="c1"># Extract observations for the months of January</span>
    <span class="n">january</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;MONTH&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Aggregate the data and get mean values</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;TEMP_F&quot;</span><span class="p">,</span> <span class="s2">&quot;TEMP_C&quot;</span><span class="p">,</span> <span class="s2">&quot;STATION_NUMBER&quot;</span><span class="p">]</span>
    <span class="n">monthly_mean</span> <span class="o">=</span> <span class="n">january</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;YEAR&quot;</span><span class="p">,</span> <span class="s2">&quot;MONTH&quot;</span><span class="p">])[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

    <span class="c1"># Sort the values and take the warmest January</span>
    <span class="n">warmest</span> <span class="o">=</span> <span class="n">monthly_mean</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;TEMP_C&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Add to results</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">warmest</span><span class="p">)</span>

<span class="c1"># Merge all the results into a single DataFrame</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
<p>Awesome! Now we have conducted the same analysis for 15 weather stations in Finland and it did not took too many lines of code! We were able to follow how the process advances with the printed lines of information, i.e. we did some simple <code class="docutils literal notranslate"><span class="pre">logging</span></code> of the operations. Let’s finally investigate our results:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">results</span>
</pre></div>
</div>
<p>Each row in the results represents the warmest January at given <code class="docutils literal notranslate"><span class="pre">STATION_NUMBER</span></code> between the years 2015 and 2019. Based on the <code class="docutils literal notranslate"><span class="pre">YEAR</span></code> column, the warmest January in most of Finland’s weather stations during this five-year period was in 2015. We can confirm this by checking the value counts of the <code class="docutils literal notranslate"><span class="pre">YEAR</span></code> column:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;YEAR&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="footnotes">
<h2>Footnotes<a class="headerlink" href="#footnotes" title="Permalink to this heading">#</a></h2>
<hr class="footnotes docutils" />
<aside class="footnote brackets" id="noaanews" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://www.noaa.gov/news/january-2020-was-earth-s-hottest-january-on-record">https://www.noaa.gov/news/january-2020-was-earth-s-hottest-january-on-record</a></p>
</aside>
<aside class="footnote brackets" id="pathlib" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://docs.python.org/3/library/pathlib.html">https://docs.python.org/3/library/pathlib.html</a></p>
</aside>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cleaning-data-while-reading">Cleaning data while reading</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#renaming-columns">Renaming columns</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-functions-with-pandas">Using functions with pandas</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-a-function">Defining a function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-a-function-by-iterating-over-rows">Using a function by iterating over rows</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-a-function-with-apply">Using a function with apply</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#string-slicing">String slicing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#question-3-5">Question 3.5</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#grouping-and-aggregating-data">Grouping and aggregating data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-logic-of-grouping-a-dataframe-using-groupby">Basic logic of grouping a DataFrame using <code class="docutils literal notranslate"><span class="pre">.groupby()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aggregating-data-with-groupby">Aggregating data with <code class="docutils literal notranslate"><span class="pre">groupby()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#case-study-detecting-warm-months">Case study: Detecting warm months</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#automating-the-analysis">Automating the analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#managing-and-listing-filesystem-paths">Managing and listing filesystem paths</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iterate-over-input-files-and-repeat-the-analysis">Iterate over input files and repeat the analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#footnotes">Footnotes</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Henrikki Tenkanen, Vuokko Heikinheimo, David Whipp
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2020-2022, Henrikki Tenkanen, Vuokko Heikinheimo, David Whipp.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>